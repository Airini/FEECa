<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>FEECa - Bernstein</title>
        <link rel="stylesheet" type="text/css" href="../../web/css/default.css" />
    </head>
    <body>

      <div style="width: 1200px; align: center" , id="container">
      <div id="menu">
        <h2 class="nav"> FEECa </h2>
        <ul class="main" style="list-style: none;">
        <li><a href="../../">Home</a></li>
        <li><a href="../../">Examples</a></li>
        <li> Documentation
            <ul class="menu">
            <li class="menu"><label>FEECa</label><ul class="menu"><li class="menu"><a href="../../src/FEECa/Bernstein.html">Bernstein.lhs</a></li><li class="menu"><a href="../../src/FEECa/FiniteElementSpace.html">FiniteElementSpace.lhs</a></li><li class="menu"><label>Internal</label><ul class="menu"><li class="menu"><a href="../../src/FEECa/Internal/MultiIndex.html">MultiIndex.lhs</a></li><li class="menu"><a href="../../src/FEECa/Internal/Point.html">Point.lhs</a></li><li class="menu"><a href="../../src/FEECa/Internal/Simplex.html">Simplex.lhs</a></li><li class="menu"><a href="../../src/FEECa/Internal/Vector.html">Vector.lhs</a></li></ul></li><li class="menu"><a href="../../src/FEECa/Polynomial.html">Polynomial.lhs</a></li><li class="menu"><a href="../../src/FEECa/PolynomialDifferentialForm.html">PolynomialDifferentialForm.lhs</a></li><li class="menu"><label>Utility</label><ul class="menu"><li class="menu"><a href="../../src/FEECa/Utility/Combinatorics.html">Combinatorics.lhs</a></li></ul></li></ul></li>
            </ul>
        </li>
        </ul>
       </div>

      <div id="main">
        <div id="content">

            <h1 id="bernstein-polynomials">Bernstein Polynomials</h1>
<p>A barycentric monomial <span class="math inline">\(\boldsymbol{B}^r_{\boldsymbol{\alpha}}\)</span> of degree <span class="math inline">\(r\)</span> defined over a simplex <span class="math inline">\(\mathcal{T}=[\boldsymbol{v_o},\ldots,\boldsymbol{v_k}]\)</span> is a product of the form</p>
<p><span class="math display">\[\begin{aligned}
  \boldsymbol{B}_{\boldsymbol{\alpha}}^r(\boldsymbol{x}) &amp;= \prod_{i = 0}^k \lambda_i^{\alpha_i}(\boldsymbol{x})\end{aligned}\]</span></p>
<p>with <span class="math inline">\(\alpha : {\mathbb{N}_0}^k \to \mathbb{N}\)</span>, <span class="math inline">\(|\alpha| = \Sigma\, \alpha = r\)</span> and the <span class="math inline">\(\lambda_i\)</span> the barycentric coordinates with respect to <span class="math inline">\(\mathcal{T}\)</span>.</p>
<p>The space <span class="math inline">\(\mathcal{P}_{r}(\mathcal{f})\)</span> of polynomials of degree at most <span class="math inline">\(r\)</span> in <span class="math inline">\(n\)</span> dimensions defined over a <span class="math inline">\(k\)</span>-dimensional subsimplex <span class="math inline">\(\mathcal{f}\)</span> of an <span class="math inline">\(n\)</span>-dimensional simplex <span class="math inline">\(\mathcal{T}\)</span> is isomorphic to the space of <span class="math inline">\(\mathcal{H}_{r}(\mathbb{R}^{k+1})\)</span> of homogeneous polynomials over the <span class="math inline">\(k+1\)</span> barycentric coordinates</p>
<p><span class="math display">\[\begin{aligned}
  \lambda_{\sigma(0)},\dots,\lambda_{\sigma(k)}.\end{aligned}\]</span></p>
<p>where <span class="math inline">\(\sigma : {\mathbb{N}_0}^k \to {\mathbb{N}_0}^n\)</span> is the (increasing) map determining the subset of vertices of <span class="math inline">\(\mathcal{T}\)</span> that form the subsimplex <span class="math inline">\(\mathcal{f}\)</span>.</p>
<p>The barycentric monomials <span class="math inline">\(\boldsymbol{B}^r_{\boldsymbol{\alpha}}\)</span> thus form a basis for the space <span class="math inline">\(\mathcal{P}_{r}(\mathcal{f})\)</span>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode haskell literate"><code class="sourceCode haskell"><a class="sourceLine" id="cb1-1" title="1"></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="ot">{-# LANGUAGE TypeFamilies           #-}</span></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="ot">{-# LANGUAGE FlexibleInstances      #-}</span></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="ot">{-# LANGUAGE MultiParamTypeClasses  #-}</span></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="ot">{-# LANGUAGE FlexibleContexts       #-}</span></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="ot">{-# LANGUAGE UndecidableInstances   #-}</span></a>
<a class="sourceLine" id="cb1-7" title="7"></a>
<a class="sourceLine" id="cb1-8" title="8"><span class="kw">module</span> <span class="dt">FEECa.Bernstein</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb1-9" title="9"></a>
<a class="sourceLine" id="cb1-10" title="10"><span class="kw">import</span> <span class="kw">qualified</span>  <span class="dt">FEECa.Internal.MultiIndex</span>   <span class="kw">as</span> <span class="dt">MI</span></a>
<a class="sourceLine" id="cb1-11" title="11"><span class="kw">import</span>            <span class="dt">FEECa.Internal.Simplex</span></a>
<a class="sourceLine" id="cb1-12" title="12"><span class="kw">import</span>            <span class="dt">FEECa.Internal.Spaces</span></a>
<a class="sourceLine" id="cb1-13" title="13"><span class="kw">import</span>            <span class="dt">FEECa.Internal.Vector</span></a>
<a class="sourceLine" id="cb1-14" title="14"></a>
<a class="sourceLine" id="cb1-15" title="15"><span class="kw">import</span>            <span class="dt">FEECa.Polynomial</span>        (</a>
<a class="sourceLine" id="cb1-16" title="16">                      <span class="dt">Polynomial</span>, terms, expandTerm,</a>
<a class="sourceLine" id="cb1-17" title="17">                      derivePolynomial, derivePolynomialBasis,</a>
<a class="sourceLine" id="cb1-18" title="18">                      barycentricCoordinates, barycentricGradient,</a>
<a class="sourceLine" id="cb1-19" title="19">                      barycentricGradients, localBarycentricGradients, toPairs)</a>
<a class="sourceLine" id="cb1-20" title="20"><span class="kw">import</span> <span class="kw">qualified</span>  <span class="dt">FEECa.Polynomial</span>   <span class="kw">as</span> <span class="dt">P</span> (</a>
<a class="sourceLine" id="cb1-21" title="21">                      degree, multiIndices, monomial,</a>
<a class="sourceLine" id="cb1-22" title="22">                      constant, polynomial, euclideanToBarycentric)</a>
<a class="sourceLine" id="cb1-23" title="23"></a>
<a class="sourceLine" id="cb1-24" title="24"><span class="kw">import</span>            <span class="dt">FEECa.Utility.Combinatorics</span> (choose, factorial)</a>
<a class="sourceLine" id="cb1-25" title="25"><span class="kw">import</span>            <span class="dt">FEECa.Utility.Print</span> <span class="kw">hiding</span>  (($$))</a>
<a class="sourceLine" id="cb1-26" title="26"><span class="kw">import</span>            <span class="dt">FEECa.Utility.Utility</span>       (sumR, pairM)</a></code></pre></div>
<h2 id="the-bernsteinpolynomial-type">The <code>BernsteinPolynomial</code> Type</h2>
<p>The <code>BernsteinPolynomial</code> type uses the <code>Polynomial</code> type (to represent Bernstein polynomials) and also stores the <code>Simplex</code> over which the polynomial is defined. The <code>BernsteinPolynomial</code> type provides an additional constructor for constant polynomials which are polymorphic over simplices.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode haskell literate"><code class="sourceCode haskell"><a class="sourceLine" id="cb2-1" title="1"><span class="co">-- | Bernstein polynomial over a simplex. Represented by a normal polynomial</span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="co">-- | internally and uses the generalized functions for evaluation and derivation.</span></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="kw">data</span> <span class="dt">BernsteinPolynomial</span> v r  <span class="ot">=</span> <span class="dt">Bernstein</span> (<span class="dt">Simplex</span> v) (<span class="dt">Polynomial</span> r)</a>
<a class="sourceLine" id="cb2-4" title="4">                              <span class="op">|</span> <span class="dt">Constant</span> r</a>
<a class="sourceLine" id="cb2-5" title="5">  <span class="kw">deriving</span> (<span class="dt">Eq</span>, <span class="dt">Show</span>)</a>
<a class="sourceLine" id="cb2-6" title="6"></a>
<a class="sourceLine" id="cb2-7" title="7"><span class="co">-- Pretty printing for Bernstein polyonmials.</span></a>
<a class="sourceLine" id="cb2-8" title="8"><span class="kw">instance</span> <span class="dt">Pretty</span> (<span class="dt">BernsteinPolynomial</span> v <span class="dt">Double</span>) <span class="kw">where</span></a>
<a class="sourceLine" id="cb2-9" title="9">  pPrint (<span class="dt">Bernstein</span> _ p) <span class="ot">=</span> printBernstein ts</a>
<a class="sourceLine" id="cb2-10" title="10">    <span class="kw">where</span> ts <span class="ot">=</span> <span class="fu">map</span> (expandTerm <span class="dv">0</span>) (terms p)</a>
<a class="sourceLine" id="cb2-11" title="11">  pPrint (<span class="dt">Constant</span> p)    <span class="ot">=</span> text (<span class="fu">show</span> p)</a>
<a class="sourceLine" id="cb2-12" title="12"></a>
<a class="sourceLine" id="cb2-13" title="13"><span class="co">-- | List multi-indices of the terms in the polynomial.</span></a>
<a class="sourceLine" id="cb2-14" title="14"><span class="ot">multiIndices ::</span> (<span class="dt">EuclideanSpace</span> v, r <span class="op">~</span> <span class="dt">Scalar</span> v)</a>
<a class="sourceLine" id="cb2-15" title="15">             <span class="ot">=&gt;</span> <span class="dt">BernsteinPolynomial</span> v r <span class="ot">-&gt;</span> [<span class="dt">MI.MultiIndex</span>]</a>
<a class="sourceLine" id="cb2-16" title="16">multiIndices (<span class="dt">Bernstein</span> t p) <span class="ot">=</span> P.multiIndices n p</a>
<a class="sourceLine" id="cb2-17" title="17">  <span class="kw">where</span> n <span class="ot">=</span> geometricalDimension t</a>
<a class="sourceLine" id="cb2-18" title="18">multiIndices (<span class="dt">Constant</span> _c)   <span class="ot">=</span> <span class="fu">error</span> <span class="st">&quot;multiIndices: TODO&quot;</span></a>
<a class="sourceLine" id="cb2-19" title="19"></a>
<a class="sourceLine" id="cb2-20" title="20"><span class="ot">degree ::</span> <span class="dt">BernsteinPolynomial</span> v r <span class="ot">-&gt;</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb2-21" title="21">degree (<span class="dt">Bernstein</span> _ p) <span class="ot">=</span> P.degree p</a>
<a class="sourceLine" id="cb2-22" title="22">degree (<span class="dt">Constant</span> _)    <span class="ot">=</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb2-23" title="23"></a>
<a class="sourceLine" id="cb2-24" title="24"><span class="ot">domain ::</span> <span class="dt">BernsteinPolynomial</span> v r <span class="ot">-&gt;</span> <span class="dt">Simplex</span> v</a>
<a class="sourceLine" id="cb2-25" title="25">domain (<span class="dt">Bernstein</span> t _) <span class="ot">=</span> t</a>
<a class="sourceLine" id="cb2-26" title="26">domain _ <span class="ot">=</span> <span class="fu">error</span> <span class="st">&quot;domain: No domain associated with constant Bernstein polynomial.&quot;</span></a></code></pre></div>
<h3 id="constructors">Constructors</h3>
<p>Since not all possible instances of the type <code>BernsteinPolynomial</code> represent valid Bernstein polynomials, the constructors have to make sure that the constructed polynomials are consistent. To be valid, all multi-indices must have dimension <span class="math inline">\(k+1\)</span>, where <span class="math inline">\(k\)</span> is the topological dimension of the underlying simplex <span class="math inline">\(T =
[\boldsymbol{v_0},\ldots,\boldsymbol{v_k}]\)</span>. Note that in Bernstein representation the multi-indices representing the polynomial are of dimension <span class="math inline">\(k+1\)</span>, while in the monomial representation they have dimension <span class="math inline">\(k\)</span>.</p>
<p>The function <code>polynomial</code> creates a Bernstein polynomial from a list of coefficient-multi-index pairs. The function throws an error if the provided arguments are invalid.</p>
<p>The function <code>monomial</code> creates a barycentric monomial from a given multi-index and throws an error if the dimension of simplex and the multi-index are inconsistent.</p>
<p>The function <code>constant</code> creates a constant barycentric monomial and does not require to be passed a simplex argument.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode haskell literate"><code class="sourceCode haskell"><a class="sourceLine" id="cb3-1" title="1"></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="co">-- | Create a Bernstein polynomial over the given simplex from a list of</span></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="co">-- | coefficient-multi-index pairs. An error is thrown if the dimension of the</span></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="co">-- | multi-indices and the simplex are inconsistent.</span></a>
<a class="sourceLine" id="cb3-5" title="5"><span class="ot">polynomial ::</span> (<span class="dt">EuclideanSpace</span> v, r <span class="op">~</span> <span class="dt">Scalar</span> v)</a>
<a class="sourceLine" id="cb3-6" title="6">           <span class="ot">=&gt;</span> <span class="dt">Simplex</span> v <span class="ot">-&gt;</span> [(r, <span class="dt">MI.MultiIndex</span>)] <span class="ot">-&gt;</span> <span class="dt">BernsteinPolynomial</span> v r</a>
<a class="sourceLine" id="cb3-7" title="7">polynomial t [] <span class="ot">=</span> <span class="dt">Constant</span> addId</a>
<a class="sourceLine" id="cb3-8" title="8">polynomial t l</a>
<a class="sourceLine" id="cb3-9" title="9">    <span class="op">|</span> n1 <span class="op">==</span> n2 <span class="op">+</span> <span class="dv">1</span> <span class="op">&amp;&amp;</span> termsOk <span class="ot">=</span> <span class="dt">Bernstein</span> t (P.polynomial l)</a>
<a class="sourceLine" id="cb3-10" title="10">    <span class="op">|</span> <span class="fu">otherwise</span>               <span class="ot">=</span> <span class="fu">error</span> <span class="st">&quot;polynomial: Dimensions of Simplex and Polynomials do not match.&quot;</span></a>
<a class="sourceLine" id="cb3-11" title="11">  <span class="kw">where</span> n1      <span class="ot">=</span> (dim <span class="op">.</span> <span class="fu">snd</span> <span class="op">.</span> <span class="fu">head</span>) l</a>
<a class="sourceLine" id="cb3-12" title="12">        n2      <span class="ot">=</span> topologicalDimension t</a>
<a class="sourceLine" id="cb3-13" title="13">        termsOk <span class="ot">=</span> <span class="fu">all</span> ((<span class="op">==</span> n1) <span class="op">.</span> dim <span class="op">.</span> <span class="fu">snd</span>) (<span class="fu">tail</span> l)</a>
<a class="sourceLine" id="cb3-14" title="14"></a>
<a class="sourceLine" id="cb3-15" title="15"></a>
<a class="sourceLine" id="cb3-16" title="16"><span class="co">-- | Create a Bernstein monomial over a given simplex and multi-index.</span></a>
<a class="sourceLine" id="cb3-17" title="17"><span class="ot">monomial ::</span> (<span class="dt">EuclideanSpace</span> v, r <span class="op">~</span> <span class="dt">Scalar</span> v)</a>
<a class="sourceLine" id="cb3-18" title="18">         <span class="ot">=&gt;</span> <span class="dt">Simplex</span> v <span class="ot">-&gt;</span> <span class="dt">MI.MultiIndex</span> <span class="ot">-&gt;</span> <span class="dt">BernsteinPolynomial</span> v r</a>
<a class="sourceLine" id="cb3-19" title="19">monomial t mi</a>
<a class="sourceLine" id="cb3-20" title="20">    <span class="op">|</span> n1 <span class="op">==</span> n2 <span class="op">+</span> <span class="dv">1</span> <span class="ot">=</span> <span class="dt">Bernstein</span> t (P.monomial mi)</a>
<a class="sourceLine" id="cb3-21" title="21">    <span class="op">|</span> <span class="fu">otherwise</span>    <span class="ot">=</span> <span class="fu">error</span> <span class="st">&quot;monomial: Dimension of Simplex and Polynomials do not match.&quot;</span></a>
<a class="sourceLine" id="cb3-22" title="22">  <span class="kw">where</span> n1 <span class="ot">=</span> dim mi</a>
<a class="sourceLine" id="cb3-23" title="23">        n2 <span class="ot">=</span> topologicalDimension t</a>
<a class="sourceLine" id="cb3-24" title="24"></a>
<a class="sourceLine" id="cb3-25" title="25"><span class="co">-- | Create a constant bernstein monomial.</span></a>
<a class="sourceLine" id="cb3-26" title="26"><span class="ot">constant ::</span> (<span class="dt">EuclideanSpace</span> v, r <span class="op">~</span> <span class="dt">Scalar</span> v)</a>
<a class="sourceLine" id="cb3-27" title="27">         <span class="ot">=&gt;</span> <span class="dt">Simplex</span> v <span class="ot">-&gt;</span> r <span class="ot">-&gt;</span> <span class="dt">BernsteinPolynomial</span> v r</a>
<a class="sourceLine" id="cb3-28" title="28">constant t <span class="ot">=</span> <span class="dt">Bernstein</span> t <span class="op">.</span> P.constant</a>
<a class="sourceLine" id="cb3-29" title="29"></a>
<a class="sourceLine" id="cb3-30" title="30"><span class="co">-- | Return a given barycentric coordinate in Bernstein representation.</span></a>
<a class="sourceLine" id="cb3-31" title="31"><span class="ot">barycentricCoordinate ::</span> (<span class="dt">EuclideanSpace</span> v, r <span class="op">~</span> <span class="dt">Scalar</span> v)</a>
<a class="sourceLine" id="cb3-32" title="32">                      <span class="ot">=&gt;</span> <span class="dt">Simplex</span> v <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">BernsteinPolynomial</span> v r</a>
<a class="sourceLine" id="cb3-33" title="33">barycentricCoordinate t <span class="ot">=</span> monomial t <span class="op">.</span> MI.unit (n<span class="op">+</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb3-34" title="34">  <span class="kw">where</span> n <span class="ot">=</span> topologicalDimension t</a></code></pre></div>
<h3 id="class-instantiations">Class Instantiations</h3>
<p>The Bernstein polynomials have the same algebraic structure as common polynomials over <span class="math inline">\(\mathbb{R}^{n}\)</span>. That is, they form a ring with respect to addition and multiplication of polynomials and a vector space over <span class="math inline">\(\mathrm R\)</span>. These algebraic structures are implemented by the <code>Ring</code> and <code>VectorSpace</code> classes, respectively.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode haskell literate"><code class="sourceCode haskell"><a class="sourceLine" id="cb4-1" title="1"></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="co">-- | Bernstein polynomials as a vector space.</span></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="co">-- TODO: check on this EuclideanSpace constraint... for vector space instance instead or not?</span></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="kw">instance</span> (<span class="dt">EuclideanSpace</span> v, r <span class="op">~</span> <span class="dt">Scalar</span> v) <span class="ot">=&gt;</span> <span class="dt">Module</span> (<span class="dt">BernsteinPolynomial</span> v r) <span class="kw">where</span></a>
<a class="sourceLine" id="cb4-5" title="5">  <span class="kw">type</span> <span class="dt">Scalar</span> (<span class="dt">BernsteinPolynomial</span> v r) <span class="ot">=</span> r</a>
<a class="sourceLine" id="cb4-6" title="6">  addV <span class="ot">=</span> addBernstein</a>
<a class="sourceLine" id="cb4-7" title="7">  sclV <span class="ot">=</span> scaleBernstein</a>
<a class="sourceLine" id="cb4-8" title="8"></a>
<a class="sourceLine" id="cb4-9" title="9"><span class="co">-- TODO: fix these instances (check constraints, etc. which belong where?)</span></a>
<a class="sourceLine" id="cb4-10" title="10"><span class="kw">instance</span> (<span class="dt">EuclideanSpace</span> v, <span class="dt">Field</span> (<span class="dt">Scalar</span> v), r <span class="op">~</span> <span class="dt">Scalar</span> v)  <span class="ot">=&gt;</span> <span class="dt">VectorSpace</span> (<span class="dt">BernsteinPolynomial</span> v r)</a>
<a class="sourceLine" id="cb4-11" title="11"></a>
<a class="sourceLine" id="cb4-12" title="12"><span class="co">-- | Bernstein polynomials as a ring.</span></a>
<a class="sourceLine" id="cb4-13" title="13"><span class="kw">instance</span> (<span class="dt">EuclideanSpace</span> v, r <span class="op">~</span> <span class="dt">Scalar</span> v) <span class="ot">=&gt;</span> <span class="dt">Ring</span> (<span class="dt">BernsteinPolynomial</span> v r) <span class="kw">where</span></a>
<a class="sourceLine" id="cb4-14" title="14">  add     <span class="ot">=</span> addV</a>
<a class="sourceLine" id="cb4-15" title="15">  addId   <span class="ot">=</span> <span class="dt">Constant</span> addId</a>
<a class="sourceLine" id="cb4-16" title="16">  addInv  <span class="ot">=</span> sclV (addInv mulId)</a>
<a class="sourceLine" id="cb4-17" title="17"></a>
<a class="sourceLine" id="cb4-18" title="18">  mul     <span class="ot">=</span> multiplyBernstein</a>
<a class="sourceLine" id="cb4-19" title="19">  mulId   <span class="ot">=</span> <span class="dt">Constant</span> mulId</a>
<a class="sourceLine" id="cb4-20" title="20"></a>
<a class="sourceLine" id="cb4-21" title="21">  embedIntegral <span class="ot">=</span> <span class="dt">Constant</span> <span class="op">.</span> embedIntegral</a></code></pre></div>
<p>In addition to that, the Bernstein polynomials over a simplex <span class="math inline">\(\mathcal{T}\)</span> form an inner product space with <span class="math inline">\(L^2\)</span> inner product given by</p>
<p><span class="math display">\[\begin{aligned}
      \langle u, v \rangle = \int_\mathcal{T} u \cdot v \: d\boldsymbol{x}\end{aligned}\]</span></p>
<p>This inner product over Bernstein polynomials is used to define the inner product in the space of polynomial differential forms over the simplex. In <code>FEECa</code>, the class <code>InnerProductSpace</code> is used to represent inner product spaces.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode haskell literate"><code class="sourceCode haskell"><a class="sourceLine" id="cb5-1" title="1"><span class="co">-- | Bernstein polynomials as inner product space.</span></a>
<a class="sourceLine" id="cb5-2" title="2"><span class="kw">instance</span> (<span class="dt">EuclideanSpace</span> v, r <span class="op">~</span> <span class="dt">Scalar</span> v) <span class="ot">=&gt;</span> <span class="dt">InnerProductSpace</span> (<span class="dt">BernsteinPolynomial</span> v r) <span class="kw">where</span></a>
<a class="sourceLine" id="cb5-3" title="3">  inner  <span class="ot">=</span> innerBernstein</a></code></pre></div>
<p>Finally, Bernstein polynomials are also functions that can be evaluated and derived so they are declared an instance of the class <code>Function</code>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode haskell literate"><code class="sourceCode haskell"><a class="sourceLine" id="cb6-1" title="1"></a>
<a class="sourceLine" id="cb6-2" title="2"><span class="kw">instance</span> (<span class="dt">EuclideanSpace</span> v, r <span class="op">~</span> <span class="dt">Scalar</span> v)</a>
<a class="sourceLine" id="cb6-3" title="3">    <span class="ot">=&gt;</span> <span class="dt">Function</span> (<span class="dt">BernsteinPolynomial</span> v r) v <span class="kw">where</span></a>
<a class="sourceLine" id="cb6-4" title="4">  evaluate <span class="ot">=</span> <span class="ot">{-# SCC &quot;evaluate&quot; #-}</span> evaluateBernstein</a>
<a class="sourceLine" id="cb6-5" title="5">  derive   <span class="ot">=</span> deriveBernsteinLocal</a></code></pre></div>
<h2 id="arithmetic">Arithmetic</h2>
<p>Addition, scaling and multiplication of Bernstein polynomials is straight-forward and can be implemented using the functions <code>addPolynomial</code>, <code>scalePolynomial</code> and <code>multiplyPolynomial</code> provided by the <code>Polynomial</code> module.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode haskell literate"><code class="sourceCode haskell"><a class="sourceLine" id="cb7-1" title="1"></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="co">-- | Add Bernstein polynomials.</span></a>
<a class="sourceLine" id="cb7-3" title="3"><span class="ot">addBernstein ::</span> (<span class="dt">EuclideanSpace</span> v, r <span class="op">~</span> <span class="dt">Scalar</span> v)</a>
<a class="sourceLine" id="cb7-4" title="4">             <span class="ot">=&gt;</span> <span class="dt">BernsteinPolynomial</span> v r <span class="ot">-&gt;</span> <span class="dt">BernsteinPolynomial</span> v r</a>
<a class="sourceLine" id="cb7-5" title="5">             <span class="ot">-&gt;</span> <span class="dt">BernsteinPolynomial</span> v r</a>
<a class="sourceLine" id="cb7-6" title="6">addBernstein (<span class="dt">Bernstein</span> t1 p1) (<span class="dt">Bernstein</span> t2 p2)</a>
<a class="sourceLine" id="cb7-7" title="7">  <span class="op">|</span> t1 <span class="op">/=</span> t2  <span class="ot">=</span> <span class="fu">error</span> <span class="st">&quot;addBernstein: Inconsistent simplices.&quot;</span></a>
<a class="sourceLine" id="cb7-8" title="8">  <span class="op">|</span> <span class="fu">otherwise</span> <span class="ot">=</span> <span class="dt">Bernstein</span> t1 (add p1 p2)</a>
<a class="sourceLine" id="cb7-9" title="9">addBernstein (<span class="dt">Constant</span> c)    (<span class="dt">Bernstein</span> t p) <span class="ot">=</span> <span class="dt">Bernstein</span> t (add p (P.constant c))</a>
<a class="sourceLine" id="cb7-10" title="10">addBernstein (<span class="dt">Bernstein</span> t p) (<span class="dt">Constant</span> c)    <span class="ot">=</span> <span class="dt">Bernstein</span> t (add p (P.constant c))</a>
<a class="sourceLine" id="cb7-11" title="11">addBernstein (<span class="dt">Constant</span> c1)   (<span class="dt">Constant</span> c2)   <span class="ot">=</span> <span class="dt">Constant</span> (add c1 c2)</a>
<a class="sourceLine" id="cb7-12" title="12"></a>
<a class="sourceLine" id="cb7-13" title="13"></a>
<a class="sourceLine" id="cb7-14" title="14"><span class="co">-- | Scale a Bernstein polynomial.</span></a>
<a class="sourceLine" id="cb7-15" title="15"><span class="ot">scaleBernstein ::</span> <span class="dt">Ring</span> r</a>
<a class="sourceLine" id="cb7-16" title="16">               <span class="ot">=&gt;</span> r <span class="ot">-&gt;</span> <span class="dt">BernsteinPolynomial</span> v r <span class="ot">-&gt;</span> <span class="dt">BernsteinPolynomial</span> v r</a>
<a class="sourceLine" id="cb7-17" title="17">scaleBernstein c  (<span class="dt">Bernstein</span> t p) <span class="ot">=</span> <span class="dt">Bernstein</span> t (sclV c p)</a>
<a class="sourceLine" id="cb7-18" title="18">scaleBernstein c1 (<span class="dt">Constant</span> c2)   <span class="ot">=</span> <span class="dt">Constant</span> (mul c1 c2)</a>
<a class="sourceLine" id="cb7-19" title="19"></a>
<a class="sourceLine" id="cb7-20" title="20"><span class="co">-- | Multiply two Bernstein polynomials.</span></a>
<a class="sourceLine" id="cb7-21" title="21"><span class="ot">multiplyBernstein ::</span> (<span class="dt">EuclideanSpace</span> v, r <span class="op">~</span> <span class="dt">Scalar</span> v)</a>
<a class="sourceLine" id="cb7-22" title="22">                  <span class="ot">=&gt;</span> <span class="dt">BernsteinPolynomial</span> v r <span class="ot">-&gt;</span> <span class="dt">BernsteinPolynomial</span> v r</a>
<a class="sourceLine" id="cb7-23" title="23">                  <span class="ot">-&gt;</span> <span class="dt">BernsteinPolynomial</span> v r</a>
<a class="sourceLine" id="cb7-24" title="24">multiplyBernstein (<span class="dt">Bernstein</span> t1 p1) (<span class="dt">Bernstein</span> t2 p2)</a>
<a class="sourceLine" id="cb7-25" title="25">  <span class="op">|</span> t1 <span class="op">/=</span> t2  <span class="ot">=</span> <span class="fu">error</span> <span class="st">&quot;multiplyBernstein: Inconsistent simplices.&quot;</span></a>
<a class="sourceLine" id="cb7-26" title="26">  <span class="op">|</span> <span class="fu">otherwise</span> <span class="ot">=</span> <span class="dt">Bernstein</span> t1 (mul p1 p2)</a>
<a class="sourceLine" id="cb7-27" title="27">multiplyBernstein (<span class="dt">Constant</span> c)      (<span class="dt">Bernstein</span> t1 p1) <span class="ot">=</span> <span class="dt">Bernstein</span> t1 (sclV c p1)</a>
<a class="sourceLine" id="cb7-28" title="28">multiplyBernstein (<span class="dt">Bernstein</span> t1 p1) (<span class="dt">Constant</span> c)      <span class="ot">=</span> <span class="dt">Bernstein</span> t1 (sclV c p1)</a>
<a class="sourceLine" id="cb7-29" title="29">multiplyBernstein (<span class="dt">Constant</span> c1)     (<span class="dt">Constant</span> c2)     <span class="ot">=</span> <span class="dt">Constant</span> (mul c1 c2)</a></code></pre></div>
<h2 id="evaluation">Evaluation</h2>
<p>Since a Bernstein polynomial is just a polynomial over the barycentric coordinates of a simplex, evaluation of a Bernstein polynomial can be implemented by first evaluating the barycentric coordinates at the given vector (i.e. at the given point in the domain Euclidean space) and then evaluating the internal or underlying polynomial at the resulting vector.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode haskell literate"><code class="sourceCode haskell"><a class="sourceLine" id="cb8-1" title="1"><span class="co">-- | Evaluate Bernstein polynomial by first evaluating the barycentric coordinates</span></a>
<a class="sourceLine" id="cb8-2" title="2"><span class="co">-- | and then evaluating the internal polynomial at the resulting vector.</span></a>
<a class="sourceLine" id="cb8-3" title="3"><span class="ot">evaluateBernstein ::</span> (<span class="dt">EuclideanSpace</span> v, r <span class="op">~</span> <span class="dt">Scalar</span> v)</a>
<a class="sourceLine" id="cb8-4" title="4">                  <span class="ot">=&gt;</span> v <span class="ot">-&gt;</span> <span class="dt">BernsteinPolynomial</span> v r <span class="ot">-&gt;</span> r</a>
<a class="sourceLine" id="cb8-5" title="5">evaluateBernstein v (<span class="dt">Bernstein</span> t p) <span class="ot">=</span> <span class="ot">{-# SCC &quot;evaluateBernstein&quot; #-}</span> evaluate vb p</a>
<a class="sourceLine" id="cb8-6" title="6">  <span class="kw">where</span> vb <span class="ot">=</span> <span class="ot">{-#SCC &quot;barycentric&quot; #-}</span> vector <span class="op">$</span> <span class="fu">map</span> (evaluate v) (barycentricCoordinates t)</a>
<a class="sourceLine" id="cb8-7" title="7">evaluateBernstein _ (<span class="dt">Constant</span> c)    <span class="ot">=</span> <span class="ot">{-# SCC &quot;evaluateConstant&quot; #-}</span> c</a>
<a class="sourceLine" id="cb8-8" title="8"></a>
<a class="sourceLine" id="cb8-9" title="9"></a>
<a class="sourceLine" id="cb8-10" title="10"><span class="ot">tabulateBernstein ::</span> (<span class="dt">EuclideanSpace</span> v, r <span class="op">~</span> <span class="dt">Scalar</span> v)</a>
<a class="sourceLine" id="cb8-11" title="11">                  <span class="ot">=&gt;</span> <span class="dt">Simplex</span> v <span class="ot">-&gt;</span> [v] <span class="ot">-&gt;</span> [<span class="dt">BernsteinPolynomial</span> v r] <span class="ot">-&gt;</span> [[r]]</a>
<a class="sourceLine" id="cb8-12" title="12">tabulateBernstein t <span class="ot">=</span> <span class="fu">map</span> <span class="op">.</span> tabulateBernstein' <span class="op">.</span> P.euclideanToBarycentric t</a>
<a class="sourceLine" id="cb8-13" title="13"></a>
<a class="sourceLine" id="cb8-14" title="14"><span class="ot">tabulateBernstein' ::</span> (<span class="dt">EuclideanSpace</span> v, r <span class="op">~</span> <span class="dt">Scalar</span> v)</a>
<a class="sourceLine" id="cb8-15" title="15">                   <span class="ot">=&gt;</span> [v] <span class="ot">-&gt;</span> <span class="dt">BernsteinPolynomial</span> v r <span class="ot">-&gt;</span> [r]</a>
<a class="sourceLine" id="cb8-16" title="16">tabulateBernstein' vs (<span class="dt">Bernstein</span> _ p) <span class="ot">=</span> <span class="fu">map</span> (p <span class="op">$$</span>) vs</a>
<a class="sourceLine" id="cb8-17" title="17">tabulateBernstein' _  _               <span class="ot">=</span> <span class="fu">error</span> <span class="st">&quot;tabulateBernstein': TODO&quot;</span></a></code></pre></div>
<h2 id="derivation">Derivation</h2>
<p>The derivative of a Bernstein monomial along a given direction in space is given by</p>
<p><span class="math display">\[\begin{align}
  \frac{d}{dx_i}\boldsymbol{B}_{\boldsymbol{\alpha}}^{r}
    &amp;= \sum_{j=0}^n \alpha_i \frac{d\lambda_j}{dx_i}\boldsymbol{B}_{\boldsymbol{\alpha^j}}^{r-1}
\end{align}\]</span></p>
<p>where <span class="math inline">\(\boldsymbol{\alpha^j}\)</span> is the multi-index <span class="math inline">\(\boldsymbol{\alpha}\)</span> with the exponent at position <span class="math inline">\(j\)</span> decreased by one and <span class="math inline">\(\frac{d\lambda_j}{dx_i}\)</span> is the <span class="math inline">\(i\)</span>-th component of the gradient of the <span class="math inline">\(j\)</span>-th barycentric coordinate. Note that the factor <span class="math inline">\(\alpha_i\)</span> in the derivation is absorbed into the prefactor <span class="math inline">\(\frac{(r-1)!}{\boldsymbol{\alpha}}\)</span> of <span class="math inline">\(\boldsymbol{B}_{\boldsymbol{\alpha^j}}^{r-1}\)</span>.</p>
<p>The derivation of Bernstein monomials is provided by <code>deriveMonomial</code>. The derivation of Bernstein polynomials is then implemented using the general function provided by the <span><strong>Polynomial</strong></span> module.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode haskell literate"><code class="sourceCode haskell"><a class="sourceLine" id="cb9-1" title="1"></a>
<a class="sourceLine" id="cb9-2" title="2"><span class="co">-- | Derivative of a Bernstein monomial</span></a>
<a class="sourceLine" id="cb9-3" title="3"><span class="ot">deriveMonomial ::</span> ( <span class="dt">EuclideanSpace</span> v, r <span class="op">~</span> <span class="dt">Scalar</span> v )</a>
<a class="sourceLine" id="cb9-4" title="4">               <span class="ot">=&gt;</span> <span class="dt">Simplex</span> v <span class="ot">-&gt;</span> <span class="dt">MI.MultiIndex</span> <span class="ot">-&gt;</span> [ <span class="dt">Polynomial</span> r ]</a>
<a class="sourceLine" id="cb9-5" title="5">deriveMonomial t mi <span class="ot">=</span> [ sumR [sclV (grads j i) (dp j) <span class="op">|</span> j <span class="ot">&lt;-</span> [<span class="dv">0</span><span class="op">..</span>n]] <span class="op">|</span> i <span class="ot">&lt;-</span> [<span class="dv">0</span><span class="op">..</span>n<span class="op">-</span><span class="dv">1</span>] ]</a>
<a class="sourceLine" id="cb9-6" title="6">    <span class="kw">where</span> grads j i <span class="ot">=</span> toList (barycentricGradients t <span class="op">!!</span> j) <span class="op">!!</span> i</a>
<a class="sourceLine" id="cb9-7" title="7">          dp j <span class="ot">=</span> <span class="kw">if</span> (mi' <span class="op">!!</span> j) <span class="op">&gt;</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb9-8" title="8">                 <span class="kw">then</span> P.polynomial [MI.derive j mi]</a>
<a class="sourceLine" id="cb9-9" title="9">                 <span class="kw">else</span> P.constant addId</a>
<a class="sourceLine" id="cb9-10" title="10">          mi'  <span class="ot">=</span> MI.toList<span class="ot"> mi ::</span> [<span class="dt">Int</span>]</a>
<a class="sourceLine" id="cb9-11" title="11">          n    <span class="ot">=</span> dim mi <span class="op">-</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb9-12" title="12"></a>
<a class="sourceLine" id="cb9-13" title="13"><span class="co">-- | Derivative of a Bernstein monomial</span></a>
<a class="sourceLine" id="cb9-14" title="14"><span class="ot">deriveMonomialLocal ::</span> ( <span class="dt">EuclideanSpace</span> v, r <span class="op">~</span> <span class="dt">Scalar</span> v )</a>
<a class="sourceLine" id="cb9-15" title="15">               <span class="ot">=&gt;</span> <span class="dt">Simplex</span> v <span class="ot">-&gt;</span> <span class="dt">MI.MultiIndex</span> <span class="ot">-&gt;</span> [ <span class="dt">Polynomial</span> r ]</a>
<a class="sourceLine" id="cb9-16" title="16">deriveMonomialLocal t mi <span class="ot">=</span> [ sumR [sclV (grads j i) (dp j) <span class="op">|</span> j <span class="ot">&lt;-</span> [<span class="dv">0</span><span class="op">..</span>n]] <span class="op">|</span> i <span class="ot">&lt;-</span> [<span class="dv">0</span><span class="op">..</span>n] ]</a>
<a class="sourceLine" id="cb9-17" title="17">    <span class="kw">where</span> grads j i <span class="ot">=</span> toList (localBarycentricGradients t <span class="op">!!</span> j) <span class="op">!!</span> i</a>
<a class="sourceLine" id="cb9-18" title="18">          dp j <span class="ot">=</span> <span class="kw">if</span> (mi' <span class="op">!!</span> j) <span class="op">&gt;</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb9-19" title="19">                 <span class="kw">then</span> P.polynomial [MI.derive j mi]</a>
<a class="sourceLine" id="cb9-20" title="20">                 <span class="kw">else</span> P.constant addId</a>
<a class="sourceLine" id="cb9-21" title="21">          mi'  <span class="ot">=</span> MI.toList<span class="ot"> mi ::</span> [<span class="dt">Int</span>]</a>
<a class="sourceLine" id="cb9-22" title="22">          n    <span class="ot">=</span> dim mi <span class="op">-</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb9-23" title="23"></a>
<a class="sourceLine" id="cb9-24" title="24"><span class="co">-- | Derive Bernstein polynomial.</span></a>
<a class="sourceLine" id="cb9-25" title="25"><span class="ot">deriveBernstein ::</span> ( <span class="dt">EuclideanSpace</span> v, r <span class="op">~</span> <span class="dt">Scalar</span> v )</a>
<a class="sourceLine" id="cb9-26" title="26">                <span class="ot">=&gt;</span> v <span class="ot">-&gt;</span> <span class="dt">BernsteinPolynomial</span> v r <span class="ot">-&gt;</span> <span class="dt">BernsteinPolynomial</span> v r</a>
<a class="sourceLine" id="cb9-27" title="27">deriveBernstein v (<span class="dt">Bernstein</span> t p) <span class="ot">=</span> <span class="dt">Bernstein</span> t (derivePolynomial (deriveMonomial t) v p)</a>
<a class="sourceLine" id="cb9-28" title="28">deriveBernstein _ (<span class="dt">Constant</span> _)    <span class="ot">=</span> <span class="dt">Constant</span> addId</a>
<a class="sourceLine" id="cb9-29" title="29"></a>
<a class="sourceLine" id="cb9-30" title="30"><span class="ot">deriveBernsteinLocal ::</span> (<span class="dt">EuclideanSpace</span> v, r <span class="op">~</span> <span class="dt">Scalar</span> v)</a>
<a class="sourceLine" id="cb9-31" title="31">                 <span class="ot">=&gt;</span> v <span class="ot">-&gt;</span> <span class="dt">BernsteinPolynomial</span> v r <span class="ot">-&gt;</span> <span class="dt">BernsteinPolynomial</span> v r</a>
<a class="sourceLine" id="cb9-32" title="32">deriveBernsteinLocal _ (<span class="dt">Constant</span> _) <span class="ot">=</span> <span class="dt">Constant</span> addId</a>
<a class="sourceLine" id="cb9-33" title="33">deriveBernsteinLocal v (<span class="dt">Bernstein</span> t p) <span class="ot">=</span> <span class="dt">Bernstein</span> t (derivePolynomial (deriveMonomialLocal t) v p)</a>
<a class="sourceLine" id="cb9-34" title="34"> </a>
<a class="sourceLine" id="cb9-35" title="35"><span class="ot">deriveBernsteinBasis ::</span> (<span class="dt">EuclideanSpace</span> v, r <span class="op">~</span> <span class="dt">Scalar</span> v)</a>
<a class="sourceLine" id="cb9-36" title="36">                     <span class="ot">=&gt;</span><span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">BernsteinPolynomial</span> v r <span class="ot">-&gt;</span> <span class="dt">BernsteinPolynomial</span> v r</a>
<a class="sourceLine" id="cb9-37" title="37">deriveBernsteinBasis _ (<span class="dt">Constant</span> _) <span class="ot">=</span> <span class="dt">Constant</span> addId</a>
<a class="sourceLine" id="cb9-38" title="38">deriveBernsteinBasis i (<span class="dt">Bernstein</span> t p) <span class="ot">=</span> <span class="dt">Bernstein</span> t (derivePolynomialBasis</a>
<a class="sourceLine" id="cb9-39" title="39">                                                      (deriveMonomialLocal t) i p)</a></code></pre></div>
<h2 id="integration">Integration</h2>
<p>For the integration of Bernstein polynomials two functions are provided.</p>
<p>The first one uses the quadrature rule over simplices to compute integrals over arbitrary simplices. This is implemented by the <code>integrate</code> function.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode haskell literate"><code class="sourceCode haskell"><a class="sourceLine" id="cb10-1" title="1"></a>
<a class="sourceLine" id="cb10-2" title="2"><span class="co">-- | Numerically integrate the Bernstein polyonomial p over the simplex t using</span></a>
<a class="sourceLine" id="cb10-3" title="3"><span class="co">-- | a Gauss-Jacobi quadrature rule.</span></a>
<a class="sourceLine" id="cb10-4" title="4"><span class="ot">integratePolynomial ::</span> (<span class="dt">EuclideanSpace</span> v, r <span class="op">~</span> <span class="dt">Scalar</span> v)</a>
<a class="sourceLine" id="cb10-5" title="5">                    <span class="ot">=&gt;</span> <span class="dt">Simplex</span> v <span class="ot">-&gt;</span> <span class="dt">BernsteinPolynomial</span> v r <span class="ot">-&gt;</span> r</a>
<a class="sourceLine" id="cb10-6" title="6">integratePolynomial t b</a>
<a class="sourceLine" id="cb10-7" title="7">  <span class="op">|</span> topologicalDimension t <span class="op">==</span> <span class="dv">0</span> <span class="ot">=</span> evaluate (referenceVertex t) b</a>
<a class="sourceLine" id="cb10-8" title="8">  <span class="op">|</span> <span class="fu">otherwise</span>                   <span class="ot">=</span> integrateOverSimplex q t (b <span class="op">$$</span>)</a>
<a class="sourceLine" id="cb10-9" title="9">  <span class="kw">where</span> q <span class="ot">=</span> <span class="fu">div</span> (r <span class="op">+</span> <span class="dv">2</span>) <span class="dv">2</span></a>
<a class="sourceLine" id="cb10-10" title="10">        r <span class="ot">=</span> degree b</a></code></pre></div>
<p>The second function computes the integral of a Bernstein polynomial over the simplex it is defined over, which is given by <span class="math display">\[\begin{aligned}
  \int_{\mathcal{T}}\boldsymbol{B}_{\boldsymbol{\alpha}}^{r} \: d\boldsymbol{x} &amp;=%
    \frac{\boldsymbol{\alpha}!}{r!}\frac{|\mathcal{T}|}%
         {\left ( \begin{array}{c} k + d \\ k \end{array} \right )}\end{aligned}\]</span></p>
<p>where <span class="math inline">\(k\)</span> is the topological dimension of the simplex. Since this requires the simplex the polynomial is defined over to be known this function does not work for the <code>Constant</code> constructor. The <code>redefine</code> function can be used to add the information about the simplex to the Bernstein polynomial.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode haskell literate"><code class="sourceCode haskell"><a class="sourceLine" id="cb11-1" title="1"></a>
<a class="sourceLine" id="cb11-2" title="2"><span class="co">-- | Closed-form integration of Bernstein polynomials over the simplex they are</span></a>
<a class="sourceLine" id="cb11-3" title="3"><span class="co">-- | defined over.</span></a>
<a class="sourceLine" id="cb11-4" title="4"><span class="ot">integrateBernstein ::</span> (<span class="dt">EuclideanSpace</span> v, r <span class="op">~</span> <span class="dt">Scalar</span> v)</a>
<a class="sourceLine" id="cb11-5" title="5">                   <span class="ot">=&gt;</span> <span class="dt">BernsteinPolynomial</span> v r <span class="ot">-&gt;</span> r</a>
<a class="sourceLine" id="cb11-6" title="6">integrateBernstein (<span class="dt">Bernstein</span> t1 p) <span class="ot">=</span> sumR (<span class="fu">map</span> f (toPairs k p))</a>
<a class="sourceLine" id="cb11-7" title="7">  <span class="kw">where</span> f (c, mi)   <span class="ot">=</span> mul c (divide (mul (factorialMI mi) vol)</a>
<a class="sourceLine" id="cb11-8" title="8">                                    (mul (factorial' (MI.degree mi)) (fac mi)))</a>
<a class="sourceLine" id="cb11-9" title="9">        factorialMI <span class="ot">=</span> <span class="fu">fromDouble</span> <span class="op">.</span> MI.factorial</a>
<a class="sourceLine" id="cb11-10" title="10">        factorial'  <span class="ot">=</span> <span class="fu">fromDouble</span> <span class="op">.</span> factorial</a>
<a class="sourceLine" id="cb11-11" title="11">        fac mi      <span class="ot">=</span> <span class="fu">fromDouble</span> (<span class="fu">fromInteger</span> ((k <span class="op">+</span> MI.degree mi) <span class="ot">`choose`</span> k))</a>
<a class="sourceLine" id="cb11-12" title="12">        k     <span class="ot">=</span> topologicalDimension t1</a>
<a class="sourceLine" id="cb11-13" title="13">        vol   <span class="ot">=</span> volume t1</a>
<a class="sourceLine" id="cb11-14" title="14">integrateBernstein (<span class="dt">Constant</span> _) <span class="ot">=</span> <span class="fu">error</span> <span class="st">&quot;intergrateBernstein: No associated simplex for constant. Define over simplex first using redefine.&quot;</span></a>
<a class="sourceLine" id="cb11-15" title="15"></a>
<a class="sourceLine" id="cb11-16" title="16"><span class="co">-- | Redefined Bernstein polynomial over a different simplex or define simplex</span></a>
<a class="sourceLine" id="cb11-17" title="17"><span class="co">-- | for constant bernstein polynomial.</span></a>
<a class="sourceLine" id="cb11-18" title="18"><span class="ot">redefine ::</span> <span class="dt">Ring</span> r</a>
<a class="sourceLine" id="cb11-19" title="19">         <span class="ot">=&gt;</span> <span class="dt">Simplex</span> v <span class="ot">-&gt;</span> <span class="dt">BernsteinPolynomial</span> v r <span class="ot">-&gt;</span> <span class="dt">BernsteinPolynomial</span> v r</a>
<a class="sourceLine" id="cb11-20" title="20">redefine t1 (<span class="dt">Bernstein</span> _ p) <span class="ot">=</span> <span class="dt">Bernstein</span> t1 p</a>
<a class="sourceLine" id="cb11-21" title="21">redefine t  (<span class="dt">Constant</span> c)    <span class="ot">=</span> <span class="dt">Bernstein</span> t (P.constant c)</a>
<a class="sourceLine" id="cb11-22" title="22"></a>
<a class="sourceLine" id="cb11-23" title="23"><span class="co">-- | Inner product of Bernstein polynomials defined over a simplex T. If both</span></a>
<a class="sourceLine" id="cb11-24" title="24"><span class="co">-- | polynomials are constant and have no associated simplex, a simplex with</span></a>
<a class="sourceLine" id="cb11-25" title="25"><span class="co">-- | volume 1 is assumed.</span></a>
<a class="sourceLine" id="cb11-26" title="26"><span class="ot">innerBernstein ::</span> (<span class="dt">EuclideanSpace</span> v, r <span class="op">~</span> <span class="dt">Scalar</span> v)</a>
<a class="sourceLine" id="cb11-27" title="27">               <span class="ot">=&gt;</span> <span class="dt">BernsteinPolynomial</span> v r <span class="ot">-&gt;</span> <span class="dt">BernsteinPolynomial</span> v r <span class="ot">-&gt;</span> r</a>
<a class="sourceLine" id="cb11-28" title="28">innerBernstein (<span class="dt">Constant</span> c1) (<span class="dt">Constant</span> c2) <span class="ot">=</span> mul c1 c2</a>
<a class="sourceLine" id="cb11-29" title="29">innerBernstein b1 b2 <span class="ot">=</span> integrateBernstein (multiplyBernstein b1 b2)</a></code></pre></div>
<h2 id="basis-for-differential-forms">Basis for Differential Forms</h2>
<p>The gradients of the barycentric coordinates</p>
<p><span class="math display">\[\begin{aligned}
  d\lambda_i = \left ( \begin{array}{c} \frac{d\lambda_i}{dx_0} \\
                          \vdots \\
                      \frac{d\lambda_i}{dx_{n-1}} \end{array} \right )\end{aligned}\]</span></p>
<p>of a simplex <span class="math inline">\(\mathcal{T}\)</span> span the space of alternating one-forms in <span class="math inline">\(\mathbb{R}^{n}\)</span>. The projection along the gradient then amounts to simply forming the dot product with the gradient vector.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode haskell literate"><code class="sourceCode haskell"><a class="sourceLine" id="cb12-1" title="1"></a>
<a class="sourceLine" id="cb12-2" title="2"><span class="co">-- | Projection function for gradients of barycentric coordinates as basis for</span></a>
<a class="sourceLine" id="cb12-3" title="3"><span class="co">-- | the space of alternating forms.</span></a>
<a class="sourceLine" id="cb12-4" title="4"><span class="ot">proj ::</span> (<span class="dt">EuclideanSpace</span> v, r <span class="op">~</span> <span class="dt">Scalar</span> v)</a>
<a class="sourceLine" id="cb12-5" title="5">     <span class="ot">=&gt;</span> <span class="dt">Simplex</span> v <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> v <span class="ot">-&gt;</span> r</a>
<a class="sourceLine" id="cb12-6" title="6">proj t i  <span class="ot">=</span> dot (barycentricGradient t i)</a></code></pre></div>
<h2 id="extension-of-bernstein-polynomials">Extension of Bernstein Polynomials</h2>
<p>The extension of a Bernstein polynomial from a face of a simplex to the simplex is simply the polynomial that results from extending each of the multi-indices representing the polynomial to the simplex. For the extension of multi-indices see <a href="#sec:mi_extension" data-reference-type="ref" data-reference="sec:mi_extension">[sec:mi_extension]</a>.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode haskell literate"><code class="sourceCode haskell"><a class="sourceLine" id="cb13-1" title="1"></a>
<a class="sourceLine" id="cb13-2" title="2"><span class="co">-- | Extend a Bernstein polynomial defined on a subsimplex f to the simplex t.</span></a>
<a class="sourceLine" id="cb13-3" title="3"><span class="ot">extend ::</span> (<span class="dt">EuclideanSpace</span> v, r <span class="op">~</span> <span class="dt">Scalar</span> v)</a>
<a class="sourceLine" id="cb13-4" title="4">       <span class="ot">=&gt;</span> <span class="dt">Simplex</span> v <span class="ot">-&gt;</span> <span class="dt">BernsteinPolynomial</span> v r <span class="ot">-&gt;</span> <span class="dt">BernsteinPolynomial</span> v r</a>
<a class="sourceLine" id="cb13-5" title="5">extend t (<span class="dt">Bernstein</span> f p) <span class="ot">=</span> polynomial t (extend' (toPairs n' p))</a>
<a class="sourceLine" id="cb13-6" title="6">  <span class="kw">where</span>  extend'  <span class="ot">=</span> <span class="fu">map</span> (pairM <span class="fu">id</span> (MI.extend n (sigma f)))</a>
<a class="sourceLine" id="cb13-7" title="7">         n        <span class="ot">=</span> topologicalDimension t</a>
<a class="sourceLine" id="cb13-8" title="8">         n'       <span class="ot">=</span> topologicalDimension f</a>
<a class="sourceLine" id="cb13-9" title="9">extend _ c <span class="ot">=</span> c</a>
<a class="sourceLine" id="cb13-10" title="10"></a>
<a class="sourceLine" id="cb13-11" title="11"><span class="co">-- | Restricts the multi-indices of polynomial to the given face and discards all terms</span></a>
<a class="sourceLine" id="cb13-12" title="12"><span class="co">-- | that are non-zero of the face.</span></a>
<a class="sourceLine" id="cb13-13" title="13"><span class="ot">trace ::</span> (<span class="dt">EuclideanSpace</span> v, r <span class="op">~</span> <span class="dt">Scalar</span> v)</a>
<a class="sourceLine" id="cb13-14" title="14">      <span class="ot">=&gt;</span> <span class="dt">Simplex</span> v <span class="ot">-&gt;</span> <span class="dt">BernsteinPolynomial</span> v r <span class="ot">-&gt;</span> <span class="dt">BernsteinPolynomial</span> v r</a>
<a class="sourceLine" id="cb13-15" title="15">trace f (<span class="dt">Bernstein</span> t p) <span class="ot">=</span> polynomial f <span class="op">$</span> (trace' <span class="op">.</span> removeZeros) (toPairs n' p)</a>
<a class="sourceLine" id="cb13-16" title="16">  <span class="kw">where</span>  trace'      <span class="ot">=</span> <span class="fu">map</span> (pairM <span class="fu">id</span> (MI.restrict (sigma f)))</a>
<a class="sourceLine" id="cb13-17" title="17">         removeZeros <span class="ot">=</span> <span class="fu">filter</span> <span class="op">$</span> (MI.is_in_range (sigma f)) <span class="op">.</span> <span class="fu">snd</span></a>
<a class="sourceLine" id="cb13-18" title="18">         n'     <span class="ot">=</span> topologicalDimension f</a>
<a class="sourceLine" id="cb13-19" title="19">trace f c <span class="ot">=</span> redefine f c</a></code></pre></div>

        </div>
        <div id="footer">
            Site proudly generated by
            <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>
      </div>
      </div>

    </body>
</html>
