<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>FEECa - FiniteElementSpace</title>
        <link rel="stylesheet" type="text/css" href="../../web/css/default.css" />
    </head>
    <body>

      <div style="width: 1200px; align: center" , id="container">
      <div id="menu">
        <h2 class="nav"> FEECa </h2>
        <ul class="main" style="list-style: none;">
        <li><a href="../../">Home</a></li>
        <li><a href="../../">Examples</a></li>
        <li> Documentation
            <ul class="menu">
            <li class="menu"><label>FEECa</label><ul class="menu"><li class="menu"><a href="../../src/FEECa/Bernstein.html">Bernstein.lhs</a></li><li class="menu"><a href="../../src/FEECa/FiniteElementSpace.html">FiniteElementSpace.lhs</a></li><li class="menu"><label>Internal</label><ul class="menu"><li class="menu"><a href="../../src/FEECa/Internal/MultiIndex.html">MultiIndex.lhs</a></li><li class="menu"><a href="../../src/FEECa/Internal/Point.html">Point.lhs</a></li><li class="menu"><a href="../../src/FEECa/Internal/Simplex.html">Simplex.lhs</a></li><li class="menu"><a href="../../src/FEECa/Internal/Vector.html">Vector.lhs</a></li></ul></li><li class="menu"><a href="../../src/FEECa/Polynomial.html">Polynomial.lhs</a></li><li class="menu"><a href="../../src/FEECa/PolynomialDifferentialForm.html">PolynomialDifferentialForm.lhs</a></li><li class="menu"><label>Utility</label><ul class="menu"><li class="menu"><a href="../../src/FEECa/Utility/Combinatorics.html">Combinatorics.lhs</a></li></ul></li></ul></li>
            </ul>
        </li>
        </ul>
       </div>

      <div id="main">
        <div id="content">

            <h1 id="finite-element-spaces">Finite Element Spaces</h1>
<p>The <code>FiniteElementSpace</code> module provides functions for the generation of finite element bases over simplices. The implementation is based on the article by <span class="citation" data-cites="ArnoldFalkWinther">Arnold, Falk, and Winther (2009)</span>.</p>
<p>Bases are provided for the two families of spaces <span class="math inline">\(\mathcal{P}_{r}\Lambda^{k}\)</span> and <span class="math inline">\(\mathcal{P}_{r}^-\Lambda^{k}\)</span>. <span class="math inline">\(\mathcal{P}_{r}\Lambda^{k}\)</span> is the space of polynomial differential <span class="math inline">\(k\)</span>-forms of degree at most <span class="math inline">\(r\)</span>. The space <span class="math inline">\(\mathcal{P}_{r}^-\Lambda^{k}\)</span> is defined as <span class="math display">\[\begin{aligned}
\mathcal{P}_{r}^-\Lambda^{k} &amp;= \{ \omega \in \mathcal{P}_{r}\Lambda^{k} ~|~ \kappa \omega \in \mathcal{P}_{r}\Lambda^{k-1} \}\end{aligned}\]</span> where <span class="math inline">\(\kappa\)</span> is the Koszul operator.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode haskell literate"><code class="sourceCode haskell"><a class="sourceLine" id="cb1-1" title="1"></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="ot">{-# LANGUAGE FlexibleContexts #-}</span></a>
<a class="sourceLine" id="cb1-3" title="3"></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="kw">module</span> <span class="dt">FEECa.FiniteElementSpace</span> (</a>
<a class="sourceLine" id="cb1-5" title="5"></a>
<a class="sourceLine" id="cb1-6" title="6">    <span class="dt">FiniteElementSpace</span> (<span class="op">..</span>), <span class="dt">Name</span>(<span class="op">..</span>), <span class="dt">BasisFunction</span></a>
<a class="sourceLine" id="cb1-7" title="7"></a>
<a class="sourceLine" id="cb1-8" title="8">  , finiteElementSpace, basis, dofs, nDofs, vspaceDim, degree, arity, simplex</a>
<a class="sourceLine" id="cb1-9" title="9">  , prmLkBasis, prmLkFace</a>
<a class="sourceLine" id="cb1-10" title="10">  , whitneyForm, psi'</a>
<a class="sourceLine" id="cb1-11" title="11"></a>
<a class="sourceLine" id="cb1-12" title="12">  , <span class="dt">Simplex</span>, <span class="dt">Vector</span></a>
<a class="sourceLine" id="cb1-13" title="13"></a>
<a class="sourceLine" id="cb1-14" title="14"> <span class="co">-- * Introduction</span></a>
<a class="sourceLine" id="cb1-15" title="15"> <span class="co">-- $intro</span></a>
<a class="sourceLine" id="cb1-16" title="16">  ) <span class="kw">where</span></a>
<a class="sourceLine" id="cb1-17" title="17"></a>
<a class="sourceLine" id="cb1-18" title="18"><span class="kw">import</span>            <span class="dt">Data.List</span></a>
<a class="sourceLine" id="cb1-19" title="19"><span class="kw">import</span>            <span class="dt">Data.Function</span> (on)</a>
<a class="sourceLine" id="cb1-20" title="20"><span class="kw">import</span> <span class="kw">qualified</span>  <span class="dt">Math.Combinatorics.Exact.Binomial</span> <span class="kw">as</span> <span class="dt">CBin</span></a>
<a class="sourceLine" id="cb1-21" title="21"></a>
<a class="sourceLine" id="cb1-22" title="22"><span class="kw">import</span>            <span class="dt">FEECa.Utility.Combinatorics</span>     (increasingLists, sublists)</a>
<a class="sourceLine" id="cb1-23" title="23"><span class="kw">import</span>            <span class="dt">FEECa.Utility.Print</span>             (printForm, dlambda)</a>
<a class="sourceLine" id="cb1-24" title="24"><span class="kw">import</span> <span class="kw">qualified</span>  <span class="dt">FEECa.Utility.Print</span>       <span class="kw">as</span> <span class="dt">P</span>  (<span class="dt">Pretty</span>(..))</a>
<a class="sourceLine" id="cb1-25" title="25"><span class="kw">import</span>            <span class="dt">FEECa.Utility.Utility</span>           (pairM, sumV)</a>
<a class="sourceLine" id="cb1-26" title="26"></a>
<a class="sourceLine" id="cb1-27" title="27"><span class="kw">import</span>            <span class="dt">FEECa.Internal.Form</span>   <span class="kw">hiding</span>    (arity, inner)</a>
<a class="sourceLine" id="cb1-28" title="28"><span class="kw">import</span> <span class="kw">qualified</span>  <span class="dt">FEECa.Internal.MultiIndex</span> <span class="kw">as</span> <span class="dt">MI</span></a>
<a class="sourceLine" id="cb1-29" title="29"><span class="kw">import</span> <span class="kw">qualified</span>  <span class="dt">FEECa.Internal.Simplex</span>    <span class="kw">as</span> <span class="dt">S</span></a>
<a class="sourceLine" id="cb1-30" title="30"><span class="kw">import</span>            <span class="dt">FEECa.Internal.Spaces</span> <span class="kw">hiding</span>    (inner)</a>
<a class="sourceLine" id="cb1-31" title="31"><span class="kw">import</span> <span class="kw">qualified</span>  <span class="dt">FEECa.Internal.Vector</span>     <span class="kw">as</span> <span class="dt">V</span></a>
<a class="sourceLine" id="cb1-32" title="32"></a>
<a class="sourceLine" id="cb1-33" title="33"><span class="kw">import</span>            <span class="dt">FEECa.Bernstein</span>                 (constant, monomial)</a>
<a class="sourceLine" id="cb1-34" title="34"><span class="kw">import</span> <span class="kw">qualified</span>  <span class="dt">FEECa.Bernstein</span>           <span class="kw">as</span> <span class="dt">B</span>  (extend)</a>
<a class="sourceLine" id="cb1-35" title="35"><span class="kw">import</span> <span class="kw">qualified</span>  <span class="dt">FEECa.PolynomialDifferentialForm</span> <span class="kw">as</span> <span class="dt">D</span></a>
<a class="sourceLine" id="cb1-36" title="36"></a>
<a class="sourceLine" id="cb1-37" title="37"></a>
<a class="sourceLine" id="cb1-38" title="38"><span class="co">-- $intro</span></a>
<a class="sourceLine" id="cb1-39" title="39"><span class="co">-- This file implements the finite element space $P_r\Lambda^k$ and $P_r^-\Lambda^k$</span></a>
<a class="sourceLine" id="cb1-40" title="40"><span class="co">--  in n dimensions. The implementation is based on the article &quot;Geomentric De-</span></a>
<a class="sourceLine" id="cb1-41" title="41"><span class="co">-- compositions and Local Bases for Spaces of Finite Element Differential Forms&quot; by</span></a>
<a class="sourceLine" id="cb1-42" title="42"><span class="co">-- Arnold, Falk, Winther. References given in the comments refer to this article.</span></a></code></pre></div>
<h2 id="the-finiteelementspace-data-type">The <code>FiniteElementSpace</code> Data Type</h2>
<p>The <code>FiniteElementSpace</code> type represents a finite element space over a simplex. It provides three type constructors. The <code>PrLk</code> and the <code>PrmLk</code> constructors to represent the spaces <span class="math inline">\(\mathcal{P}_{r}\Lambda^{k}\)</span> and <span class="math inline">\(\mathcal{P}_{r}^-\Lambda^{k}\)</span>, respectively and the <code>GenSpace</code> constructor to represent a general space by a set of basis functions.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode haskell literate"><code class="sourceCode haskell"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">type</span> <span class="dt">Vector</span>               <span class="ot">=</span> <span class="dt">V.Vector</span> <span class="dt">Double</span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="kw">type</span> <span class="dt">Simplex</span>              <span class="ot">=</span> <span class="dt">S.Simplex</span> <span class="dt">Vector</span></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="kw">type</span> <span class="dt">BernsteinPolynomial</span>  <span class="ot">=</span> <span class="dt">D.BernsteinPolynomial</span> <span class="dt">Double</span></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="kw">type</span> <span class="dt">DifferentialForm</span>     <span class="ot">=</span> <span class="dt">D.DifferentialForm</span> <span class="dt">Double</span></a>
<a class="sourceLine" id="cb2-5" title="5"></a>
<a class="sourceLine" id="cb2-6" title="6"><span class="co">-- | Data type for the two families of finite element spaces $P_r\Lambda^k$ and</span></a>
<a class="sourceLine" id="cb2-7" title="7"><span class="co">-- | $P_r^-\Lambda^k$ defined over a simplex.</span></a>
<a class="sourceLine" id="cb2-8" title="8"><span class="kw">data</span> <span class="dt">FiniteElementSpace</span> <span class="ot">=</span> <span class="dt">PrLk</span> <span class="dt">Int</span> <span class="dt">Int</span> <span class="dt">Simplex</span></a>
<a class="sourceLine" id="cb2-9" title="9">                        <span class="op">|</span> <span class="dt">PrmLk</span> <span class="dt">Int</span> <span class="dt">Int</span> <span class="dt">Simplex</span></a>
<a class="sourceLine" id="cb2-10" title="10">                          <span class="kw">deriving</span>( <span class="dt">Show</span> )</a>
<a class="sourceLine" id="cb2-11" title="11"></a>
<a class="sourceLine" id="cb2-12" title="12"><span class="co">-- | Type synomym for basis function of finite element spaces that are of type</span></a>
<a class="sourceLine" id="cb2-13" title="13"><span class="co">-- | Form BernsteinPolynomial.</span></a>
<a class="sourceLine" id="cb2-14" title="14"><span class="kw">type</span> <span class="dt">BasisFunction</span> <span class="ot">=</span> <span class="dt">DifferentialForm</span></a>
<a class="sourceLine" id="cb2-15" title="15"></a>
<a class="sourceLine" id="cb2-16" title="16"></a>
<a class="sourceLine" id="cb2-17" title="17"><span class="co">-- | Type synomym for a degree of freedom, i.e. a linear bounded map from</span></a>
<a class="sourceLine" id="cb2-18" title="18"><span class="co">-- | the space of polynomial differential forms to the reals.</span></a>
<a class="sourceLine" id="cb2-19" title="19"><span class="kw">type</span> <span class="dt">DoF</span> <span class="ot">=</span> <span class="dt">DifferentialForm</span> <span class="ot">-&gt;</span> <span class="dt">Double</span></a></code></pre></div>
<p>For the <span class="math inline">\(\mathcal{P}_{r}\Lambda^{k}\)</span> and <span class="math inline">\(\mathcal{P}_{r}^-\Lambda^{k}\)</span> spaces the following functions can be used to extract their properties. <code>degree</code> returns the maximum degree <span class="math inline">\(r\)</span> of the spaces, while <code>arity</code> returns the arity <span class="math inline">\(k\)</span> of the alternating forms. <code>vspaceDim</code> returns the dimension <span class="math inline">\(n\)</span> of the underlying euclidean space <span class="math inline">\(\mathbb{R}^{n}\)</span>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode haskell literate"><code class="sourceCode haskell"><a class="sourceLine" id="cb3-1" title="1"></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="co">-- | The degree of the finite element space.</span></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="ot">degree ::</span> <span class="dt">FiniteElementSpace</span> <span class="ot">-&gt;</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb3-4" title="4">degree (<span class="dt">PrLk</span> r _ _)  <span class="ot">=</span> r</a>
<a class="sourceLine" id="cb3-5" title="5">degree (<span class="dt">PrmLk</span> r _ _) <span class="ot">=</span> r</a>
<a class="sourceLine" id="cb3-6" title="6"></a>
<a class="sourceLine" id="cb3-7" title="7"><span class="co">-- | The arity of the finite element space</span></a>
<a class="sourceLine" id="cb3-8" title="8"><span class="ot">arity ::</span> <span class="dt">FiniteElementSpace</span> <span class="ot">-&gt;</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb3-9" title="9">arity (<span class="dt">PrLk</span> _ k _)  <span class="ot">=</span> k</a>
<a class="sourceLine" id="cb3-10" title="10">arity (<span class="dt">PrmLk</span> _ k _) <span class="ot">=</span> k</a>
<a class="sourceLine" id="cb3-11" title="11"></a>
<a class="sourceLine" id="cb3-12" title="12"><span class="co">-- | The simplex over which the finite element space is defined.</span></a>
<a class="sourceLine" id="cb3-13" title="13"><span class="ot">simplex ::</span> <span class="dt">FiniteElementSpace</span> <span class="ot">-&gt;</span> <span class="dt">Simplex</span></a>
<a class="sourceLine" id="cb3-14" title="14">simplex (<span class="dt">PrLk</span> _ _ t)  <span class="ot">=</span> t</a>
<a class="sourceLine" id="cb3-15" title="15">simplex (<span class="dt">PrmLk</span> _ _ t) <span class="ot">=</span> t</a>
<a class="sourceLine" id="cb3-16" title="16"></a>
<a class="sourceLine" id="cb3-17" title="17"><span class="co">-- | The dimension of the underlying vector space.</span></a>
<a class="sourceLine" id="cb3-18" title="18"><span class="ot">vspaceDim ::</span> <span class="dt">FiniteElementSpace</span> <span class="ot">-&gt;</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb3-19" title="19">vspaceDim (<span class="dt">PrLk</span> _ _ t)  <span class="ot">=</span> S.geometricalDimension t</a>
<a class="sourceLine" id="cb3-20" title="20">vspaceDim (<span class="dt">PrmLk</span> _ _ t) <span class="ot">=</span> S.geometricalDimension t</a></code></pre></div>
<p>The function <code>dim</code> can be used to compute the dimension of the spaces which are given by</p>
<p><span class="math display">\[\begin{aligned}
      \text{dim }\mathcal{P}_{r}^-\Lambda^{k} &amp;=  \left ( \begin{array}{c} n + r \\ n \end{array} \right )  \left ( \begin{array}{c} n \\ k \end{array} \right )  \\
      \text{dim }\mathcal{P}_{r}^-\Lambda^{k} &amp;=  \left ( \begin{array}{c} r + k - 1 \\ k \end{array} \right )  \left ( \begin{array}{c}  n + r  \\  n - k  \end{array} \right ) \end{aligned}\]</span></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode haskell literate"><code class="sourceCode haskell"><a class="sourceLine" id="cb4-1" title="1"></a>
<a class="sourceLine" id="cb4-2" title="2"></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="co">-- | The dimension of the finite element space.</span></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="kw">instance</span> <span class="dt">Dimensioned</span> <span class="dt">FiniteElementSpace</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb4-5" title="5">    dim (<span class="dt">PrmLk</span> r k t) <span class="ot">=</span> ((r <span class="op">+</span> k <span class="op">-</span> <span class="dv">1</span>) <span class="ot">`CBin.choose`</span> k) <span class="op">*</span> ((n <span class="op">+</span> r) <span class="ot">`CBin.choose`</span> (n <span class="op">-</span> k))</a>
<a class="sourceLine" id="cb4-6" title="6">        <span class="kw">where</span> n <span class="ot">=</span> S.topologicalDimension t</a>
<a class="sourceLine" id="cb4-7" title="7">    dim (<span class="dt">PrLk</span> r k t) <span class="ot">=</span> ((r <span class="op">+</span> k) <span class="ot">`CBin.choose`</span> r ) <span class="op">*</span> ((n <span class="op">+</span> r) <span class="ot">`CBin.choose`</span> (n <span class="op">-</span> k))</a>
<a class="sourceLine" id="cb4-8" title="8">        <span class="kw">where</span> n <span class="ot">=</span> S.topologicalDimension t</a></code></pre></div>
<p>Finally, the actual work is performed by the <code>basis</code> function which computes the basis elements of a given <span class="math inline">\(\mathcal{P}_{r}\Lambda^{k}\)</span> or <span class="math inline">\(\mathcal{P}_{r}^-\Lambda^{k}\)</span> space. The implementation is described below.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode haskell literate"><code class="sourceCode haskell"><a class="sourceLine" id="cb5-1" title="1"></a>
<a class="sourceLine" id="cb5-2" title="2"><span class="co">-- | List the basis functions of the given finite element space.</span></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="ot">basis ::</span> <span class="dt">FiniteElementSpace</span> <span class="ot">-&gt;</span> [<span class="dt">BasisFunction</span>]</a>
<a class="sourceLine" id="cb5-4" title="4">basis (<span class="dt">PrmLk</span> r k t) <span class="ot">=</span> prmLkBasis r k t</a>
<a class="sourceLine" id="cb5-5" title="5">basis (<span class="dt">PrLk</span> r k t) <span class="ot">=</span> prLkBasis r k t</a>
<a class="sourceLine" id="cb5-6" title="6"></a>
<a class="sourceLine" id="cb5-7" title="7"><span class="co">-- | List the basis functions of the given finite element space.</span></a>
<a class="sourceLine" id="cb5-8" title="8"><span class="ot">dofs ::</span> <span class="dt">FiniteElementSpace</span> <span class="ot">-&gt;</span> [<span class="dt">DoF</span>]</a>
<a class="sourceLine" id="cb5-9" title="9">dofs (<span class="dt">PrmLk</span> r k t) <span class="ot">=</span> prmLkDofs r k t</a>
<a class="sourceLine" id="cb5-10" title="10">dofs (<span class="dt">PrLk</span> r k t)  <span class="ot">=</span> prLkDofs  r k t</a>
<a class="sourceLine" id="cb5-11" title="11"></a>
<a class="sourceLine" id="cb5-12" title="12"><span class="co">-- | List the basis functions of the given finite element space.</span></a>
<a class="sourceLine" id="cb5-13" title="13"><span class="ot">nDofs ::</span> <span class="dt">FiniteElementSpace</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb5-14" title="14">nDofs (<span class="dt">PrmLk</span> r k t) k2 <span class="ot">=</span> prmLkNDofs r k t k2</a>
<a class="sourceLine" id="cb5-15" title="15">nDofs (<span class="dt">PrLk</span> r k t)  k2 <span class="ot">=</span> prLkNDofs  r k t k2</a>
<a class="sourceLine" id="cb5-16" title="16"></a>
<a class="sourceLine" id="cb5-17" title="17"><span class="ot">pPrintBasisFunction ::</span> <span class="dt">BasisFunction</span> <span class="ot">-&gt;</span> <span class="dt">String</span></a>
<a class="sourceLine" id="cb5-18" title="18">pPrintBasisFunction <span class="ot">=</span> <span class="fu">show</span> <span class="op">.</span> printForm dlambda <span class="st">&quot;0&quot;</span> P.pPrint</a>
<a class="sourceLine" id="cb5-19" title="19">                           <span class="op">.</span> terms</a>
<a class="sourceLine" id="cb5-20" title="20"></a>
<a class="sourceLine" id="cb5-21" title="21"><span class="ot">pPrint ::</span> [<span class="dt">BasisFunction</span>] <span class="ot">-&gt;</span> <span class="dt">IO</span> ()</a>
<a class="sourceLine" id="cb5-22" title="22">pPrint [] <span class="ot">=</span> <span class="fu">putStrLn</span> <span class="st">&quot;Empty List\n&quot;</span></a>
<a class="sourceLine" id="cb5-23" title="23">pPrint l  <span class="ot">=</span> <span class="fu">putStrLn</span> <span class="op">$</span> <span class="st">&quot;[ &quot;</span> <span class="op">++</span> <span class="fu">foldl</span> render (pPrintBasisFunction (<span class="fu">head</span> l)) (<span class="fu">tail</span> l)</a>
<a class="sourceLine" id="cb5-24" title="24">                            <span class="op">++</span> <span class="st">&quot;]&quot;</span></a>
<a class="sourceLine" id="cb5-25" title="25">    <span class="kw">where</span> render s bf <span class="ot">=</span> s <span class="op">++</span> <span class="st">&quot;,\n&quot;</span> <span class="op">++</span> pPrintBasisFunction bf</a></code></pre></div>
<h2 id="concrete-spaces">Concrete Spaces</h2>
<p>For the construction of finite element spaces over a given simplex the <code>finiteElementSpace</code> function is provided. It takes the name of one of the primary spaces of finite elements as presented in <span class="citation" data-cites="ArnoldLogg">(Arnold and Logg 2014)</span>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode haskell literate"><code class="sourceCode haskell"><a class="sourceLine" id="cb6-1" title="1"><span class="co">-- | Name data type to represent the named finite elements. See</span></a>
<a class="sourceLine" id="cb6-2" title="2"><span class="co">-- | &lt;http://www.femtable.org Periodic Table of the Finite Elements&gt;.</span></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="kw">data</span> <span class="dt">Name</span> <span class="ot">=</span> <span class="dt">P</span></a>
<a class="sourceLine" id="cb6-4" title="4">          <span class="op">|</span> <span class="dt">Pm</span></a>
<a class="sourceLine" id="cb6-5" title="5">          <span class="op">|</span> <span class="dt">DP</span></a>
<a class="sourceLine" id="cb6-6" title="6">          <span class="op">|</span> <span class="dt">DPm</span></a>
<a class="sourceLine" id="cb6-7" title="7">          <span class="op">|</span> <span class="dt">RT</span></a>
<a class="sourceLine" id="cb6-8" title="8">          <span class="op">|</span> <span class="dt">N1e</span></a>
<a class="sourceLine" id="cb6-9" title="9">          <span class="op">|</span> <span class="dt">N1f</span></a>
<a class="sourceLine" id="cb6-10" title="10">          <span class="op">|</span> <span class="dt">BDM</span></a>
<a class="sourceLine" id="cb6-11" title="11">          <span class="op">|</span> <span class="dt">N2e</span></a>
<a class="sourceLine" id="cb6-12" title="12">          <span class="op">|</span> <span class="dt">N2f</span></a>
<a class="sourceLine" id="cb6-13" title="13"></a>
<a class="sourceLine" id="cb6-14" title="14"><span class="co">-- | Create named finite element space of given polynomial degree over the</span></a>
<a class="sourceLine" id="cb6-15" title="15"><span class="co">-- | given simplex.</span></a>
<a class="sourceLine" id="cb6-16" title="16"><span class="ot">finiteElementSpace ::</span> <span class="dt">Name</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Simplex</span> <span class="ot">-&gt;</span> <span class="dt">FiniteElementSpace</span></a>
<a class="sourceLine" id="cb6-17" title="17">finiteElementSpace <span class="dt">P</span>    r t <span class="ot">=</span> <span class="dt">PrLk</span>  r <span class="dv">0</span> t</a>
<a class="sourceLine" id="cb6-18" title="18">finiteElementSpace <span class="dt">Pm</span>   r t <span class="ot">=</span> <span class="dt">PrmLk</span> r <span class="dv">0</span> t</a>
<a class="sourceLine" id="cb6-19" title="19">finiteElementSpace <span class="dt">DP</span>   r t <span class="ot">=</span> <span class="dt">PrLk</span>  r (S.topologicalDimension t) t</a>
<a class="sourceLine" id="cb6-20" title="20">finiteElementSpace <span class="dt">DPm</span>  r t <span class="ot">=</span> <span class="dt">PrmLk</span> r (S.topologicalDimension t) t</a>
<a class="sourceLine" id="cb6-21" title="21">finiteElementSpace <span class="dt">RT</span>   r t</a>
<a class="sourceLine" id="cb6-22" title="22">  <span class="op">|</span> S.topologicalDimension t <span class="op">==</span> <span class="dv">2</span> <span class="ot">=</span> <span class="dt">PrmLk</span> r <span class="dv">1</span> t</a>
<a class="sourceLine" id="cb6-23" title="23">  <span class="op">|</span> <span class="fu">otherwise</span> <span class="ot">=</span> <span class="fu">error</span> <span class="st">&quot;RT elements are defined in two dimensions.&quot;</span></a>
<a class="sourceLine" id="cb6-24" title="24">finiteElementSpace <span class="dt">N1e</span> r t</a>
<a class="sourceLine" id="cb6-25" title="25">  <span class="op">|</span> S.topologicalDimension t <span class="op">==</span> <span class="dv">3</span> <span class="ot">=</span> <span class="dt">PrmLk</span> r <span class="dv">1</span> t</a>
<a class="sourceLine" id="cb6-26" title="26">  <span class="op">|</span> <span class="fu">otherwise</span> <span class="ot">=</span> <span class="fu">error</span> <span class="st">&quot;N1e1 elements are defined in three dimensions.&quot;</span></a>
<a class="sourceLine" id="cb6-27" title="27">finiteElementSpace <span class="dt">N1f</span> r t</a>
<a class="sourceLine" id="cb6-28" title="28">  <span class="op">|</span> S.topologicalDimension t <span class="op">==</span> <span class="dv">3</span> <span class="ot">=</span> <span class="dt">PrmLk</span> r <span class="dv">2</span> t</a>
<a class="sourceLine" id="cb6-29" title="29">  <span class="op">|</span> <span class="fu">otherwise</span> <span class="ot">=</span> <span class="fu">error</span> <span class="st">&quot;N1f1 elements are defined in three dimensions.&quot;</span></a>
<a class="sourceLine" id="cb6-30" title="30">finiteElementSpace <span class="dt">BDM</span> r t</a>
<a class="sourceLine" id="cb6-31" title="31">  <span class="op">|</span> S.topologicalDimension t <span class="op">==</span> <span class="dv">2</span> <span class="ot">=</span> <span class="dt">PrLk</span> r <span class="dv">1</span> t</a>
<a class="sourceLine" id="cb6-32" title="32">  <span class="op">|</span> <span class="fu">otherwise</span> <span class="ot">=</span> <span class="fu">error</span> <span class="st">&quot;BDM elements are defined in two dimensions.&quot;</span></a>
<a class="sourceLine" id="cb6-33" title="33">finiteElementSpace <span class="dt">N2e</span> r t</a>
<a class="sourceLine" id="cb6-34" title="34">  <span class="op">|</span> S.topologicalDimension t <span class="op">==</span> <span class="dv">3</span> <span class="ot">=</span> <span class="dt">PrLk</span> r <span class="dv">1</span> t</a>
<a class="sourceLine" id="cb6-35" title="35">  <span class="op">|</span> <span class="fu">otherwise</span> <span class="ot">=</span> <span class="fu">error</span> <span class="st">&quot;N2e1 elements are defined in three dimensions.&quot;</span></a>
<a class="sourceLine" id="cb6-36" title="36">finiteElementSpace <span class="dt">N2f</span> r t</a>
<a class="sourceLine" id="cb6-37" title="37">  <span class="op">|</span> S.topologicalDimension t <span class="op">==</span> <span class="dv">3</span> <span class="ot">=</span> <span class="dt">PrLk</span> r <span class="dv">2</span> t</a>
<a class="sourceLine" id="cb6-38" title="38">  <span class="op">|</span> <span class="fu">otherwise</span> <span class="ot">=</span> <span class="fu">error</span> <span class="st">&quot;N2f1 elements are defined in three dimensions.&quot;</span></a></code></pre></div>
<h2 id="construction-of-bases">Construction of Bases</h2>
<p>For the construction of finite element bases we use the geometric decompositions proposed in section 9 in <span class="citation" data-cites="ArnoldFalkWinther">(Arnold, Falk, and Winther 2009)</span>.</p>
<p>Let <span class="math inline">\(\mathcal{f}\)</span> be a face of a simplex <span class="math inline">\(\mathcal{T}\)</span> In the following we write <span class="math inline">\(\mathcal{I}(\mathcal{f})\)</span> to denote the set of indices of vertices of <span class="math inline">\(\mathcal{T}\)</span> included in the subsimplex <span class="math inline">\(\mathcal{f}\)</span>. This is the same as the range of the map <span class="math inline">\(\sigma\)</span> representing the subsimplex</p>
<p><span class="math display">\[\begin{aligned}
  \mathcal{I}(\mathcal{f}) &amp;= \text{range} ( \sigma )\end{aligned}\]</span></p>
<p>Moreover, we define the range operator applied to a face and a map <span class="math inline">\(\sigma\)</span>:</p>
<p><span class="math display">\[\begin{aligned}
  \text{range}(\mathcal{f},\sigma) = \mathcal{I}(\mathcal{f}) \cup \text{range}(\sigma)\end{aligned}\]</span></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode haskell literate"><code class="sourceCode haskell"><a class="sourceLine" id="cb7-1" title="1"></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="co">-- | The range operator for a multi-index and an increasing list.</span></a>
<a class="sourceLine" id="cb7-3" title="3"><span class="fu">range</span><span class="ot"> ::</span> <span class="dt">MI.MultiIndex</span> <span class="ot">-&gt;</span> [<span class="dt">Int</span>] <span class="ot">-&gt;</span> [<span class="dt">Int</span>]</a>
<a class="sourceLine" id="cb7-4" title="4"><span class="fu">range</span> mi sigma <span class="ot">=</span> <span class="fu">sort</span> sigma <span class="ot">`union`</span> MI.range mi</a></code></pre></div>
<h3 id="the-mathcalp_r-lambdak-spaces">The <span class="math inline">\(\mathcal{P}_{r}^-\Lambda^{k}\)</span> Spaces</h3>
<p>An import building block in the construction of bases for the <span class="math inline">\(\mathcal{P}_{r}^-\Lambda^{k}\)</span> spaces are the so called Whitney forms. Let <span class="math inline">\(\mathcal{f}\)</span> be a subsimplex of <span class="math inline">\(\mathcal{T}\)</span> and <span class="math inline">\(\sigma \in \Sigma(0:k,0:n)\)</span>. The Whitney form <span class="math inline">\(\phi_\sigma^\mathcal{f}\)</span> is defined as:</p>
<p><span class="math display">\[\begin{aligned}
  \phi_\sigma^{\mathcal{f}} &amp;= \sum_{i=0}^k (-1)^i\lambda^\mathcal{f}_i d\lambda^{\mathcal{f}}_0
                          \wedge \ldots \wedge d\lambda^{\mathcal{f}}_{i-1} \wedge
                          d\lambda^{\mathcal{f}}_{i+1} \wedge \ldots \wedge
                                          d\lambda^{\mathcal{f}}_k\end{aligned}\]</span></p>
<p>where we have used <span class="math inline">\(\lambda_i^{\mathcal{f}}\)</span> to denote the barycentric coordinates of the face <span class="math inline">\(\mathcal{f}\)</span>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode haskell literate"><code class="sourceCode haskell"><a class="sourceLine" id="cb8-1" title="1"></a>
<a class="sourceLine" id="cb8-2" title="2"><span class="co">-- | The Whitney forms as given by  equation (6.3).</span></a>
<a class="sourceLine" id="cb8-3" title="3"><span class="ot">whitneyForm ::</span> <span class="dt">Simplex</span> <span class="ot">-&gt;</span> [<span class="dt">Int</span>] <span class="ot">-&gt;</span> <span class="dt">Form</span> <span class="dt">BernsteinPolynomial</span></a>
<a class="sourceLine" id="cb8-4" title="4">whitneyForm t sigma <span class="ot">=</span> <span class="dt">Form</span> k n [ (lambda' i, subsets <span class="op">!!</span> i) <span class="op">|</span> i <span class="ot">&lt;-</span> [<span class="dv">0</span><span class="op">..</span>k]]</a>
<a class="sourceLine" id="cb8-5" title="5">  <span class="kw">where</span> k <span class="ot">=</span> <span class="fu">length</span> sigma <span class="op">-</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb8-6" title="6">        n <span class="ot">=</span> S.topologicalDimension t</a>
<a class="sourceLine" id="cb8-7" title="7">        subsets <span class="ot">=</span> sublists sigma</a>
<a class="sourceLine" id="cb8-8" title="8">        lambda' i <span class="ot">=</span> sclV ((<span class="op">-</span><span class="dv">1</span>)<span class="op">^</span>i) (monomial t (MI.unit (n <span class="op">+</span> <span class="dv">1</span>) (sigma <span class="op">!!</span> i)))</a></code></pre></div>
<p>The Whitney form <span class="math inline">\(\phi_\sigma = \phi^{\mathcal{T}}\)</span> is obtained by extending the differential form to <span class="math inline">\(T\)</span>. The extension is performed simply by identifying the barycentric coordinates <span class="math inline">\(\lambda^{\mathcal{f}}_i\)</span> with the corresponding ones on the supersimplex</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode haskell literate"><code class="sourceCode haskell"><a class="sourceLine" id="cb9-1" title="1"></a>
<a class="sourceLine" id="cb9-2" title="2"><span class="co">-- | Extend a differential Form defined on a face of a simplex to the full simplex.</span></a>
<a class="sourceLine" id="cb9-3" title="3"><span class="co">-- | Implements the barycentric extension operator defined in eq. (7.1) in</span></a>
<a class="sourceLine" id="cb9-4" title="4"><span class="co">-- | Arnold, Falk, Winther.</span></a>
<a class="sourceLine" id="cb9-5" title="5"><span class="ot">extend ::</span> <span class="dt">Simplex</span> <span class="ot">-&gt;</span> <span class="dt">Form</span> <span class="dt">BernsteinPolynomial</span> <span class="ot">-&gt;</span> <span class="dt">Form</span> <span class="dt">BernsteinPolynomial</span></a>
<a class="sourceLine" id="cb9-6" title="6">extend t (<span class="dt">Form</span> k _ cs) <span class="ot">=</span> <span class="dt">Form</span> k n (extend' cs)</a>
<a class="sourceLine" id="cb9-7" title="7">  <span class="kw">where</span> extend' <span class="ot">=</span> <span class="fu">map</span> (pairM (B.extend t) (extendFace n))</a>
<a class="sourceLine" id="cb9-8" title="8">        n       <span class="ot">=</span> S.topologicalDimension t</a>
<a class="sourceLine" id="cb9-9" title="9"></a>
<a class="sourceLine" id="cb9-10" title="10"><span class="co">-- | Extend the face of a subsimplex of a simplex of topological dimension n to the</span></a>
<a class="sourceLine" id="cb9-11" title="11"><span class="co">-- | the simplex. That is, for a face given as an increasing list of vertices of the</span></a>
<a class="sourceLine" id="cb9-12" title="12"><span class="co">-- | subsimplex, return the list of vertices of the simplex that corresponds to that</span></a>
<a class="sourceLine" id="cb9-13" title="13"><span class="co">-- | face.</span></a>
<a class="sourceLine" id="cb9-14" title="14"><span class="ot">extendFace ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> [<span class="dt">Int</span>] <span class="ot">-&gt;</span> [<span class="dt">Int</span>]</a>
<a class="sourceLine" id="cb9-15" title="15">extendFace n f <span class="ot">=</span> [ [<span class="dv">0</span><span class="op">..</span>n] <span class="op">!!</span> (i<span class="op">-</span><span class="dv">1</span>) <span class="op">|</span> i <span class="ot">&lt;-</span> f ]</a></code></pre></div>
<p>Using the Whitney forms, a basis for <span class="math inline">\(\mathcal{P}_{r}^-\Lambda^{k}\)</span> can be constructed as follows. For given <span class="math inline">\(r\)</span>,<span class="math inline">\(k\)</span> and a simplex <span class="math inline">\(\mathcal{T}\)</span>, a basis of the space <span class="math inline">\(\mathcal{P}_{r}^-\Lambda^{k}\)</span> is given by the set</p>
<p><span class="math display">\[\begin{align}\label{eq:basis_pl}
  \{(\lambda)^{\boldsymbol{\alpha}} \phi_\sigma | \: &amp; \boldsymbol{\alpha} \in \mathrm{N}_0^{0:n},
   |\boldsymbol{\alpha}| = r-1, \\
  &amp; \sigma \in \Sigma(0:k,0:n), \text{range}(\boldsymbol{\alpha},\sigma) = \mathcal{I}(f), \\
  &amp; \alpha_i = 0 \text{ if } i &lt; \text{min}\left ( \text{range}(\sigma) \right ) \}
\end{align}\]</span></p>
<p>The construction of this set is implemented in the function <code>prmLkBasis</code>.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode haskell literate"><code class="sourceCode haskell"><a class="sourceLine" id="cb10-1" title="1"></a>
<a class="sourceLine" id="cb10-2" title="2"><span class="co">-- | The basis of the $P_r^-\Lambda^k$ space over the given simplex constructed</span></a>
<a class="sourceLine" id="cb10-3" title="3"><span class="co">-- | using the geometric composition given by Anrold, Falk, Winther.</span></a>
<a class="sourceLine" id="cb10-4" title="4"><span class="ot">prmLkBasis ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Simplex</span> <span class="ot">-&gt;</span> [<span class="dt">Form</span> <span class="dt">BernsteinPolynomial</span>]</a>
<a class="sourceLine" id="cb10-5" title="5">prmLkBasis r k t <span class="ot">=</span> <span class="fu">concat</span> [prmLkFace t f r k <span class="op">|</span> f <span class="ot">&lt;-</span> fs]</a>
<a class="sourceLine" id="cb10-6" title="6">  <span class="kw">where</span> n      <span class="ot">=</span> S.topologicalDimension t</a>
<a class="sourceLine" id="cb10-7" title="7">        fs     <span class="ot">=</span> <span class="fu">concat</span> [S.subsimplices t i <span class="op">|</span> i <span class="ot">&lt;-</span> [k<span class="op">..</span>n]]</a>
<a class="sourceLine" id="cb10-8" title="8"></a>
<a class="sourceLine" id="cb10-9" title="9"><span class="co">-- | Basis for the space PrMinusLambdak with vanishing trace associated to</span></a>
<a class="sourceLine" id="cb10-10" title="10"><span class="co">-- | a given face of a simplex.</span></a>
<a class="sourceLine" id="cb10-11" title="11"><span class="ot">prmLkFace ::</span> <span class="dt">Simplex</span> <span class="ot">-&gt;</span> <span class="dt">Simplex</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> [<span class="dt">Form</span> <span class="dt">BernsteinPolynomial</span>]</a>
<a class="sourceLine" id="cb10-12" title="12">prmLkFace t f r k <span class="ot">=</span> [ sclV (lambda a) (phi s) <span class="op">|</span> a <span class="ot">&lt;-</span> alphas, s <span class="ot">&lt;-</span> sigmas, valid a s ]</a>
<a class="sourceLine" id="cb10-13" title="13">  <span class="kw">where</span> alphas     <span class="ot">=</span> MI.degreeR (n<span class="op">+</span><span class="dv">1</span>) (r<span class="op">-</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb10-14" title="14">        sigmas     <span class="ot">=</span> increasingLists (k<span class="op">+</span><span class="dv">1</span>) n</a>
<a class="sourceLine" id="cb10-15" title="15">        n          <span class="ot">=</span> S.topologicalDimension t</a>
<a class="sourceLine" id="cb10-16" title="16">        valid a s  <span class="ot">=</span> setEq (domain a s) (S.sigma f) <span class="op">&amp;&amp;</span> zeros a s</a>
<a class="sourceLine" id="cb10-17" title="17">        zeros a s  <span class="ot">=</span> <span class="dv">0</span> <span class="op">==</span> <span class="fu">sum</span> (<span class="fu">take</span> (<span class="fu">minimum</span> s) (MI.toList a))</a>
<a class="sourceLine" id="cb10-18" title="18">        setEq d l  <span class="ot">=</span> <span class="fu">sort</span> d <span class="op">==</span> l</a>
<a class="sourceLine" id="cb10-19" title="19">        domain a   <span class="ot">=</span> union (MI.range a)</a>
<a class="sourceLine" id="cb10-20" title="20">        phi        <span class="ot">=</span> whitneyForm t</a>
<a class="sourceLine" id="cb10-21" title="21">        lambda     <span class="ot">=</span> monomial t</a>
<a class="sourceLine" id="cb10-22" title="22"></a>
<a class="sourceLine" id="cb10-23" title="23"><span class="ot">prmLkDofs ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Simplex</span> <span class="ot">-&gt;</span> [<span class="dt">DoF</span>]</a>
<a class="sourceLine" id="cb10-24" title="24">prmLkDofs r k t <span class="ot">=</span> <span class="fu">concat</span> [prmLkDofsFace r k f <span class="op">|</span> f <span class="ot">&lt;-</span> fs]</a>
<a class="sourceLine" id="cb10-25" title="25">  <span class="kw">where</span> fs <span class="ot">=</span> <span class="fu">concat</span> [S.subsimplices t d <span class="op">|</span> d <span class="ot">&lt;-</span> [<span class="dv">0</span><span class="op">..</span>n]]</a>
<a class="sourceLine" id="cb10-26" title="26">        n  <span class="ot">=</span> S.topologicalDimension t</a>
<a class="sourceLine" id="cb10-27" title="27"></a>
<a class="sourceLine" id="cb10-28" title="28"><span class="ot">prmLkDofsFace ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Simplex</span> <span class="ot">-&gt;</span> [<span class="dt">DoF</span>]</a>
<a class="sourceLine" id="cb10-29" title="29">prmLkDofsFace r k f</a>
<a class="sourceLine" id="cb10-30" title="30">  <span class="op">|</span> r' <span class="op">&lt;</span> <span class="dv">0</span> <span class="ot">=</span> []</a>
<a class="sourceLine" id="cb10-31" title="31">  <span class="op">|</span> k' <span class="op">&lt;</span> <span class="dv">0</span> <span class="ot">=</span> []</a>
<a class="sourceLine" id="cb10-32" title="32">  <span class="op">|</span> <span class="fu">otherwise</span> <span class="ot">=</span> [\omega <span class="ot">-&gt;</span> D.integrate f (D.trace f omega <span class="op">/</span>\ eta) <span class="op">|</span> eta <span class="ot">&lt;-</span> bs]</a>
<a class="sourceLine" id="cb10-33" title="33">  <span class="kw">where</span> dimf <span class="ot">=</span> S.topologicalDimension f</a>
<a class="sourceLine" id="cb10-34" title="34">        r' <span class="ot">=</span> r <span class="op">+</span> k <span class="op">-</span> dimf <span class="op">-</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb10-35" title="35">        k' <span class="ot">=</span> dimf <span class="op">-</span> k</a>
<a class="sourceLine" id="cb10-36" title="36">        bs <span class="ot">=</span> prLkBasis r' k' f</a>
<a class="sourceLine" id="cb10-37" title="37"></a>
<a class="sourceLine" id="cb10-38" title="38"><span class="ot">prmLkNDofs ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Simplex</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb10-39" title="39">prmLkNDofs r k t k2 <span class="ot">=</span> <span class="fu">sum</span> [dim (<span class="dt">PrLk</span> r' k' f) <span class="op">|</span> f <span class="ot">&lt;-</span> S.subsimplices t k2]</a>
<a class="sourceLine" id="cb10-40" title="40">  <span class="kw">where</span> r' <span class="ot">=</span> r <span class="op">+</span> k <span class="op">-</span> k2 <span class="op">-</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb10-41" title="41">        k' <span class="ot">=</span> k2 <span class="op">-</span> k</a></code></pre></div>
<h3 id="the-mathcalp_rlambdak-spaces">The <span class="math inline">\(\mathcal{P}_{r}\Lambda^{k}\)</span> Spaces</h3>
<p>The construction of the <span class="math inline">\(\mathcal{P}_{r}\Lambda^{k}\)</span> spaces uses another set primitive <span class="math inline">\(k\)</span>-forms. Let <span class="math inline">\(\mathcal{f}\)</span> be a face of another face <span class="math inline">\(\mathcal{g}\)</span> of the simplex <span class="math inline">\(\mathcal{T}\)</span>. Define <span class="math inline">\(\psi^{\boldsymbol{\alpha},\mathcal{f},\mathcal{g}}_{\sigma}\)</span></p>
<p><span class="math display">\[\begin{aligned}
      \psi^{\boldsymbol{\alpha},\mathcal{f},\mathcal{g}}_{i} &amp;= d\lambda_i^{\mathcal{g}} -
          \frac{\alpha_i}{|\alpha|} \sum_{j \in \mathcal{I}(\mathcal{f})} d\lambda_j^\mathcal{g} \\
     \psi^{\boldsymbol{\alpha},\mathcal{f},\mathcal{g}}_{\sigma} &amp;= \psi^{\boldsymbol{\alpha},\mathcal{f},\mathcal{g}}_{\sigma{(1)}} \wedge \ldots
                          \wedge \psi^{\boldsymbol{\alpha},\mathcal{f},\mathcal{g}}_{\sigma{(k)}}\end{aligned}\]</span></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode haskell literate"><code class="sourceCode haskell"><a class="sourceLine" id="cb11-1" title="1"><span class="co">-- | The psi forms that implement the extension operator for the $P_r\Lambda^k$</span></a>
<a class="sourceLine" id="cb11-2" title="2"><span class="co">-- | spaces as given in equations (8.1) and (8.2) in Arnold, Falk, Winther.</span></a>
<a class="sourceLine" id="cb11-3" title="3"><span class="ot">psi ::</span> <span class="dt">Simplex</span> <span class="ot">-&gt;</span> <span class="dt">Simplex</span> <span class="ot">-&gt;</span> <span class="dt">MI.MultiIndex</span> <span class="ot">-&gt;</span> [<span class="dt">Int</span>] <span class="ot">-&gt;</span> <span class="dt">Form</span> <span class="dt">BernsteinPolynomial</span></a>
<a class="sourceLine" id="cb11-4" title="4">psi t f alpha sigma  <span class="ot">=</span> <span class="fu">foldl</span> (<span class="op">/</span>\) unit [psi' t f alpha i <span class="op">|</span> i <span class="ot">&lt;-</span> sigma]</a>
<a class="sourceLine" id="cb11-5" title="5">  <span class="kw">where</span> unit <span class="ot">=</span> nullForm n mulId</a>
<a class="sourceLine" id="cb11-6" title="6">        n    <span class="ot">=</span> dim alpha <span class="op">-</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb11-7" title="7"></a>
<a class="sourceLine" id="cb11-8" title="8"><span class="co">-- TODO: Check form indices.</span></a>
<a class="sourceLine" id="cb11-9" title="9"><span class="ot">psi' ::</span> <span class="dt">Simplex</span> <span class="ot">-&gt;</span> <span class="dt">Simplex</span> <span class="ot">-&gt;</span> <span class="dt">MI.MultiIndex</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Form</span> <span class="dt">BernsteinPolynomial</span></a>
<a class="sourceLine" id="cb11-10" title="10">psi' t f alpha i <span class="ot">=</span> sumV <span class="op">$</span> db i <span class="op">:</span> <span class="fu">map</span> (sclV c <span class="op">.</span> db) sigma <span class="co">-- db j | j &lt;- sigma ]</span></a>
<a class="sourceLine" id="cb11-11" title="11">  <span class="kw">where</span> db j    <span class="ot">=</span> oneForm j n</a>
<a class="sourceLine" id="cb11-12" title="12">        <span class="co">--dxiOnT  = sclV (constant t mulId) (db i)</span></a>
<a class="sourceLine" id="cb11-13" title="13">        c       <span class="ot">=</span> (constant t <span class="op">.</span> addInv) ((divide <span class="ot">`on`</span> embedIntegral) alpha_i r)</a>
<a class="sourceLine" id="cb11-14" title="14">        <span class="co">-- TODO: check here! used to be (c j) in the list comprehension... even though j as an argument was unused</span></a>
<a class="sourceLine" id="cb11-15" title="15">        r       <span class="ot">=</span> MI.degree alpha</a>
<a class="sourceLine" id="cb11-16" title="16">        alpha_i <span class="ot">=</span> MI.toList alpha <span class="op">!!</span> i</a>
<a class="sourceLine" id="cb11-17" title="17">        n       <span class="ot">=</span> S.geometricalDimension f</a>
<a class="sourceLine" id="cb11-18" title="18">        sigma   <span class="ot">=</span> S.sigma f</a>
<a class="sourceLine" id="cb11-19" title="19"><span class="co">--psi' t f alpha i = fold subV (db i) [ sclV (c j) (db j) | j &lt;- sigma ]</span></a>
<a class="sourceLine" id="cb11-20" title="20">        <span class="co">--db j = sclV (constant t 1.0) (oneForm j n)</span></a>
<a class="sourceLine" id="cb11-21" title="21">        <span class="co">--c _  = sclV ((alpha' !! i) / r) mulId -- TODO: check here!</span></a>
<a class="sourceLine" id="cb11-22" title="22">        <span class="co">--c _  = divide (embedIntegral $ alpha' !! i) r -- sclV ((alpha' !! i) / r) mulId -- TODO: check here!</span></a>
<a class="sourceLine" id="cb11-23" title="23">        <span class="co">--alpha' = map fromInteger $ MI.toList alpha</span></a></code></pre></div>
<p>where <span class="math inline">\(\sigma \in \Sigma(0:k,0:n)\)</span> and <span class="math inline">\(k\)</span> and <span class="math inline">\(n\)</span> the topological dimensions of <span class="math inline">\(\mathcal{f}\)</span> and <span class="math inline">\(\mathcal{g}\)</span>, respectively.</p>
<p>A basis for the space <span class="math inline">\(\mathcal{P}_{r}\Lambda^{k}\)</span> is then given by the set</p>
<p><span class="math display">\[\begin{align}\label{eq:basis_pml}
  \{(\lambda^{\mathcal{T}})^{\boldsymbol{\alpha}} \psi_\sigma | \: &amp; \boldsymbol{\alpha} \in \mathrm{N}_0^{0:n},
   |\boldsymbol{\alpha}| = r, \\
  &amp; \sigma \in \Sigma(1:k,0:n), \text{range}(\boldsymbol{\alpha},\sigma) = \mathcal{I}(f), \\
  &amp; \alpha_i = 0 \text{ if } i &lt; \text{min}\left (\mathcal{I}(\mathcal{f}) /\ \text{range}(\sigma) \right ) \}
\end{align}\]</span></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode haskell literate"><code class="sourceCode haskell"><a class="sourceLine" id="cb12-1" title="1"></a>
<a class="sourceLine" id="cb12-2" title="2"><span class="co">-- | Basis of the $P_r\Lambda^k$ space over the given simplex constructed using</span></a>
<a class="sourceLine" id="cb12-3" title="3"><span class="co">-- | the geometric decomposition given by Arnold, Falk, Winther.</span></a>
<a class="sourceLine" id="cb12-4" title="4"><span class="ot">prLkBasis ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Simplex</span> <span class="ot">-&gt;</span> [<span class="dt">Form</span> <span class="dt">BernsteinPolynomial</span>]</a>
<a class="sourceLine" id="cb12-5" title="5">prLkBasis r k t <span class="ot">=</span> <span class="fu">concat</span> [prLkFace t f r k <span class="op">|</span> f <span class="ot">&lt;-</span> fs]</a>
<a class="sourceLine" id="cb12-6" title="6">  <span class="kw">where</span> n  <span class="ot">=</span> S.topologicalDimension t</a>
<a class="sourceLine" id="cb12-7" title="7">        fs <span class="ot">=</span> <span class="fu">concat</span> [S.subsimplices t i <span class="op">|</span> i <span class="ot">&lt;-</span> [k<span class="op">..</span>n]]</a>
<a class="sourceLine" id="cb12-8" title="8"></a>
<a class="sourceLine" id="cb12-9" title="9"><span class="co">-- | Basis functions  for the space PrMinusLambdak associated to</span></a>
<a class="sourceLine" id="cb12-10" title="10"><span class="co">-- | a given face of a simplex.</span></a>
<a class="sourceLine" id="cb12-11" title="11"><span class="ot">prLkFace ::</span> <span class="dt">Simplex</span> <span class="ot">-&gt;</span> <span class="dt">Simplex</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> [<span class="dt">Form</span> <span class="dt">BernsteinPolynomial</span>]</a>
<a class="sourceLine" id="cb12-12" title="12">prLkFace t f r k <span class="ot">=</span> [ sclV (lambda a) (psi'' a s) <span class="op">|</span> a <span class="ot">&lt;-</span> alphas, s <span class="ot">&lt;-</span> sigmas, valid a s ]</a>
<a class="sourceLine" id="cb12-13" title="13">  <span class="kw">where</span> alphas     <span class="ot">=</span> MI.degreeR (n<span class="op">+</span><span class="dv">1</span>) r</a>
<a class="sourceLine" id="cb12-14" title="14">        sigmas     <span class="ot">=</span> increasingLists k n</a>
<a class="sourceLine" id="cb12-15" title="15">        n          <span class="ot">=</span> S.topologicalDimension t</a>
<a class="sourceLine" id="cb12-16" title="16">        valid a s  <span class="ot">=</span> setEq (domain a s) (S.sigma f) <span class="op">&amp;&amp;</span> zeros a s</a>
<a class="sourceLine" id="cb12-17" title="17">        zeros a s  <span class="ot">=</span> <span class="dv">0</span> <span class="op">==</span> <span class="fu">sum</span> (<span class="fu">take</span> (minimum' <span class="op">$</span> S.sigma f \\ s) (MI.toList a))</a>
<a class="sourceLine" id="cb12-18" title="18">        setEq d l  <span class="ot">=</span> <span class="fu">sort</span> d <span class="op">==</span> l</a>
<a class="sourceLine" id="cb12-19" title="19">        domain a s <span class="ot">=</span> MI.range a <span class="ot">`union`</span> s</a>
<a class="sourceLine" id="cb12-20" title="20">        psi''      <span class="ot">=</span> psi t f</a>
<a class="sourceLine" id="cb12-21" title="21">        lambda     <span class="ot">=</span> monomial t</a>
<a class="sourceLine" id="cb12-22" title="22">        minimum' s <span class="ot">=</span> <span class="kw">if</span> <span class="fu">null</span> s <span class="kw">then</span> <span class="dv">0</span> <span class="kw">else</span> <span class="fu">minimum</span> s</a>
<a class="sourceLine" id="cb12-23" title="23"></a>
<a class="sourceLine" id="cb12-24" title="24"><span class="co">-- | Basis for the space PrMinusLambdak with vanishing trace associated to</span></a>
<a class="sourceLine" id="cb12-25" title="25"><span class="co">-- | a given face of a simplex.</span></a>
<a class="sourceLine" id="cb12-26" title="26"><span class="ot">prLkFace' ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Simplex</span> <span class="ot">-&gt;</span> [<span class="dt">Form</span> <span class="dt">BernsteinPolynomial</span>]</a>
<a class="sourceLine" id="cb12-27" title="27">prLkFace' r k t <span class="ot">=</span> [<span class="dt">Form</span> k n [(b alpha, sigma)] <span class="op">|</span> alpha <span class="ot">&lt;-</span> alphas</a>
<a class="sourceLine" id="cb12-28" title="28">                                               , sigma <span class="ot">&lt;-</span> sigmas alpha]</a>
<a class="sourceLine" id="cb12-29" title="29">  <span class="kw">where</span> n       <span class="ot">=</span> S.topologicalDimension t</a>
<a class="sourceLine" id="cb12-30" title="30">        b       <span class="ot">=</span> monomial t</a>
<a class="sourceLine" id="cb12-31" title="31">        alphas  <span class="ot">=</span> MI.degreeR (n <span class="op">+</span> <span class="dv">1</span>)  r</a>
<a class="sourceLine" id="cb12-32" title="32">        sigmas alpha <span class="ot">=</span> [ sigma <span class="op">|</span> sigma <span class="ot">&lt;-</span> increasingLists k n</a>
<a class="sourceLine" id="cb12-33" title="33">                               , <span class="fu">range</span> alpha sigma <span class="op">==</span> [<span class="dv">0</span><span class="op">..</span>n]</a>
<a class="sourceLine" id="cb12-34" title="34">                               , isZero alpha sigma ]</a>
<a class="sourceLine" id="cb12-35" title="35">        isZero alpha sigma <span class="ot">=</span> <span class="fu">all</span> (<span class="dv">0</span><span class="op">==</span>) (<span class="fu">take</span> (minimum' sigma) (MI.toList alpha))</a>
<a class="sourceLine" id="cb12-36" title="36">        minimum' sigma     <span class="ot">=</span> <span class="fu">minimum</span> ([<span class="dv">0</span><span class="op">..</span>n] \\ sigma)</a>
<a class="sourceLine" id="cb12-37" title="37"></a>
<a class="sourceLine" id="cb12-38" title="38"><span class="ot">prLkDofs ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Simplex</span> <span class="ot">-&gt;</span> [<span class="dt">DoF</span>]</a>
<a class="sourceLine" id="cb12-39" title="39">prLkDofs r k t <span class="ot">=</span> <span class="fu">concat</span> [prLkDofsFace r k f <span class="op">|</span> f <span class="ot">&lt;-</span> fs]</a>
<a class="sourceLine" id="cb12-40" title="40">  <span class="kw">where</span> fs <span class="ot">=</span> <span class="fu">concat</span> [S.subsimplices t d <span class="op">|</span> d <span class="ot">&lt;-</span> [<span class="dv">0</span><span class="op">..</span>n]]</a>
<a class="sourceLine" id="cb12-41" title="41">        n  <span class="ot">=</span> S.topologicalDimension t</a>
<a class="sourceLine" id="cb12-42" title="42"></a>
<a class="sourceLine" id="cb12-43" title="43"><span class="ot">prLkDofsFace ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Simplex</span> <span class="ot">-&gt;</span> [<span class="dt">DoF</span>]</a>
<a class="sourceLine" id="cb12-44" title="44">prLkDofsFace r k f</a>
<a class="sourceLine" id="cb12-45" title="45">  <span class="op">|</span> r' <span class="op">&lt;</span> <span class="dv">0</span> <span class="ot">=</span> []</a>
<a class="sourceLine" id="cb12-46" title="46">  <span class="op">|</span> k' <span class="op">&lt;</span> <span class="dv">0</span> <span class="ot">=</span> []</a>
<a class="sourceLine" id="cb12-47" title="47">  <span class="op">|</span> <span class="fu">otherwise</span> <span class="ot">=</span> [\omega <span class="ot">-&gt;</span> D.integrate f (D.trace f omega <span class="op">/</span>\ eta) <span class="op">|</span> eta <span class="ot">&lt;-</span> bs]</a>
<a class="sourceLine" id="cb12-48" title="48">  <span class="kw">where</span> dimf <span class="ot">=</span> S.topologicalDimension f</a>
<a class="sourceLine" id="cb12-49" title="49">        r' <span class="ot">=</span> r <span class="op">+</span> k <span class="op">-</span> dimf</a>
<a class="sourceLine" id="cb12-50" title="50">        k' <span class="ot">=</span> dimf <span class="op">-</span> k</a>
<a class="sourceLine" id="cb12-51" title="51">        bs <span class="ot">=</span> prmLkBasis r' k' f</a>
<a class="sourceLine" id="cb12-52" title="52"></a>
<a class="sourceLine" id="cb12-53" title="53"><span class="ot">prLkNDofs ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Simplex</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb12-54" title="54">prLkNDofs r k t k2</a>
<a class="sourceLine" id="cb12-55" title="55">  <span class="op">|</span> r' <span class="op">&lt;</span> <span class="dv">0</span> <span class="ot">=</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb12-56" title="56">  <span class="op">|</span> k' <span class="op">&lt;</span> <span class="dv">0</span> <span class="ot">=</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb12-57" title="57">  <span class="op">|</span> <span class="fu">otherwise</span> <span class="ot">=</span> <span class="fu">sum</span> [dim <span class="op">$</span> <span class="dt">PrmLk</span> r' k' f <span class="op">|</span> f <span class="ot">&lt;-</span> S.subsimplices t k2]</a>
<a class="sourceLine" id="cb12-58" title="58">  <span class="kw">where</span> r' <span class="ot">=</span> r <span class="op">+</span> k <span class="op">-</span> k2</a>
<a class="sourceLine" id="cb12-59" title="59">        k' <span class="ot">=</span> k2 <span class="op">-</span> k</a>
<a class="sourceLine" id="cb12-60" title="60"></a>
<a class="sourceLine" id="cb12-61" title="61"><span class="co">{-</span></a>
<a class="sourceLine" id="cb12-62" title="62"><span class="co">t = S.referenceSimplex 2</span></a>
<a class="sourceLine" id="cb12-63" title="63"><span class="co">t2 = S.subsimplex t 2 0</span></a>
<a class="sourceLine" id="cb12-64" title="64"><span class="co">t1 = S.subsimplex t 1 0</span></a>
<a class="sourceLine" id="cb12-65" title="65"></a>
<a class="sourceLine" id="cb12-66" title="66"><span class="co">b = monomial t1 (MI.multiIndex [1,2])</span></a>
<a class="sourceLine" id="cb12-67" title="67"><span class="co">omega = Form 2 2 [(b, [0,1])] :: DifferentialForm</span></a>
<a class="sourceLine" id="cb12-68" title="68"><span class="co">eta = Form 0 2 [(b,[0])]</span></a>
<a class="sourceLine" id="cb12-69" title="69"></a>
<a class="sourceLine" id="cb12-70" title="70"><span class="co">alpha = MI.multiIndex [2,1]</span></a>
<a class="sourceLine" id="cb12-71" title="71"><span class="co">sigma = [0,1]</span></a>
<a class="sourceLine" id="cb12-72" title="72"><span class="co">s1 = finiteElementSpace N2f 3 t</span></a>
<a class="sourceLine" id="cb12-73" title="73"><span class="co">-}</span></a></code></pre></div>
<h1 id="bibliography" class="unnumbered">Bibliography</h1>
<div id="refs" class="references" role="doc-bibliography">
<div id="ref-ArnoldFalkWinther">
<p>Arnold, Douglas N., Richard S. Falk, and Ragnar Winther. 2009. Geometric Decompositions and Local Bases for Spaces of Finite Element Differential Forms. <em>Comput. Methods Appl. Mech. Engrg.</em> 198: 166072. <a href="http://umn.edu/~arnold/papers/decomp.pdf">http://umn.edu/~arnold/papers/decomp.pdf</a>.</p>
</div>
<div id="ref-ArnoldLogg">
<p>Arnold, Douglas N., and Anders Logg. 2014. Periodic Table of the Finite Elements. <em>SIAM News</em> 47 (9). <a href="http://femtable.org">http://femtable.org</a>.</p>
</div>
</div>

        </div>
        <div id="footer">
            Site proudly generated by
            <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>
      </div>
      </div>

    </body>
</html>
