<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>FEECa - PolynomialDifferentialForm</title>
        <link rel="stylesheet" type="text/css" href="../../web/css/default.css" />
    </head>
    <body>

      <div style="width: 1200px; align: center" , id="container">
      <div id="menu">
        <h2 class="nav"> FEECa </h2>
        <ul class="main" style="list-style: none;">
        <li><a href="../../">Home</a></li>
        <li><a href="../../">Examples</a></li>
        <li> Documentation
            <ul class="menu">
            <li class="menu"><label>FEECa</label><ul class="menu"><li class="menu"><a href="../../src/FEECa/Bernstein.html">Bernstein.lhs</a></li><li class="menu"><a href="../../src/FEECa/FiniteElementSpace.html">FiniteElementSpace.lhs</a></li><li class="menu"><label>Internal</label><ul class="menu"><li class="menu"><a href="../../src/FEECa/Internal/MultiIndex.html">MultiIndex.lhs</a></li><li class="menu"><a href="../../src/FEECa/Internal/Point.html">Point.lhs</a></li><li class="menu"><a href="../../src/FEECa/Internal/Simplex.html">Simplex.lhs</a></li><li class="menu"><a href="../../src/FEECa/Internal/Vector.html">Vector.lhs</a></li></ul></li><li class="menu"><a href="../../src/FEECa/Polynomial.html">Polynomial.lhs</a></li><li class="menu"><a href="../../src/FEECa/PolynomialDifferentialForm.html">PolynomialDifferentialForm.lhs</a></li><li class="menu"><label>Utility</label><ul class="menu"><li class="menu"><a href="../../src/FEECa/Utility/Combinatorics.html">Combinatorics.lhs</a></li></ul></li></ul></li>
            </ul>
        </li>
        </ul>
       </div>

      <div id="main">
        <div id="content">

            <div class="sourceCode"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><span class="ot">{-# LANGUAGE GADTs #-}</span>
<span class="ot">{-# LANGUAGE FlexibleInstances #-}</span>
<span class="ot">{-# LANGUAGE UndecidableInstances #-}</span>
<span class="ot">{-# LANGUAGE FlexibleContexts #-}</span>
<span class="ot">{-# LANGUAGE TypeSynonymInstances #-}</span>
<span class="ot">{-# LANGUAGE OverloadedStrings #-}</span>

<span class="kw">module</span> <span class="dt">FEECa.PolynomialDifferentialForm</span> <span class="kw">where</span>

<span class="kw">import </span><span class="dt">Control.Applicative</span>
<span class="kw">import </span><span class="dt">Data.Maybe</span>
<span class="kw">import </span><span class="dt">Data.List</span>
<span class="kw">import </span><span class="dt">FEECa.Internal.Vector</span>
<span class="kw">import </span><span class="dt">FEECa.Internal.Simplex</span>
<span class="kw">import </span><span class="dt">FEECa.Utility.Print</span>
<span class="kw">import qualified</span> <span class="dt">FEECa.Bernstein</span>             <span class="kw">as</span> <span class="dt">B</span>
<span class="kw">import qualified</span> <span class="dt">FEECa.Internal.Form</span>         <span class="kw">as</span> <span class="dt">F</span>
<span class="kw">import qualified</span> <span class="dt">FEECa.DifferentialForm</span>      <span class="kw">as</span> <span class="dt">D</span>
<span class="kw">import qualified</span> <span class="dt">FEECa.Polynomial</span>            <span class="kw">as</span> <span class="dt">P</span>
<span class="kw">import qualified</span> <span class="dt">FEECa.Internal.Spaces</span>       <span class="kw">as</span> <span class="dt">S</span>
<span class="kw">import qualified</span> <span class="dt">FEECa.Utility.Combinatorics</span> <span class="kw">as</span> <span class="dt">C</span>
<span class="kw">import qualified</span> <span class="dt">FEECa.Internal.Vector</span>       <span class="kw">as</span> <span class="dt">V</span>

<span class="kw">type</span> <span class="dt">BernsteinPolynomial</span> a <span class="fu">=</span> <span class="dt">B.BernsteinPolynomial</span> (<span class="dt">Vector</span> a) a
<span class="kw">type</span> <span class="dt">DifferentialForm</span> a    <span class="fu">=</span> <span class="dt">D.DifferentialForm</span> (<span class="dt">BernsteinPolynomial</span> a)

<span class="kw">instance</span> <span class="dt">Show</span> (<span class="dt">BernsteinPolynomial</span> <span class="dt">Double</span>) <span class="kw">where</span>
  show b <span class="fu">=</span> show <span class="fu">$</span> pPrint b
<span class="kw">instance</span>  <span class="dt">Show</span> (<span class="dt">DifferentialForm</span> <span class="dt">Double</span>) <span class="kw">where</span>
  show omega <span class="fu">=</span> show <span class="fu">$</span> printForm (<span class="st">&quot;d&quot;</span> <span class="fu">++</span> lambda) <span class="st">&quot;0&quot;</span> pPrint (F.terms omega)

<span class="ot">findSimplex ::</span> <span class="dt">DifferentialForm</span> a <span class="ot">-&gt;</span> <span class="dt">Maybe</span> (<span class="dt">Simplex</span> (<span class="dt">Vector</span> a))
findSimplex (<span class="dt">F.Form</span> k n cs) <span class="fu">=</span> find (const <span class="dt">True</span>) <span class="fu">$</span> mapMaybe (findSimplex' <span class="fu">.</span> fst) cs

<span class="ot">findSimplex' ::</span> <span class="dt">BernsteinPolynomial</span> a <span class="ot">-&gt;</span> <span class="dt">Maybe</span> (<span class="dt">Simplex</span> (<span class="dt">Vector</span> a))
findSimplex' (<span class="dt">B.Bernstein</span> t _) <span class="fu">=</span> <span class="dt">Just</span> t
findSimplex' _ <span class="fu">=</span> <span class="dt">Nothing</span>

<span class="ot">tabulate ::</span> (<span class="dt">S.Field</span> a, <span class="dt">S.VectorSpace</span> a, <span class="dt">S.Scalar</span> a <span class="fu">~</span> a)
         <span class="ot">=&gt;</span> [<span class="dt">DifferentialForm</span> a]
         <span class="ot">-&gt;</span> [<span class="dt">Vector</span> a]
         <span class="ot">-&gt;</span> [<span class="dt">Simplex</span> (<span class="dt">Vector</span> a)]
         <span class="ot">-&gt;</span> [[a]]
tabulate bs vs fs <span class="fu">=</span> [evalSeparately t b vs fs' <span class="fu">|</span> b <span class="ot">&lt;-</span> bs]
  <span class="kw">where</span> t   <span class="fu">=</span> fromJust <span class="fu">$</span> findSimplex <span class="fu">$</span> head bs
        fs' <span class="fu">=</span> map spanningVectors fs

<span class="ot">apply ::</span> <span class="dt">S.Field</span> a <span class="ot">=&gt;</span> <span class="dt">DifferentialForm</span> a <span class="ot">-&gt;</span> [<span class="dt">Vector</span> a] <span class="ot">-&gt;</span> <span class="dt">BernsteinPolynomial</span> a
apply omega vs <span class="fu">=</span> <span class="ot">{-# SCC &quot;apply&quot; #-}</span> F.apply ds vs omega
  <span class="kw">where</span> t  <span class="fu">=</span> fromJust (findSimplex omega)
        ds <span class="fu">=</span> P.barycentricGradients t

<span class="ot">evalSeparately ::</span> (<span class="dt">S.Field</span> a, <span class="dt">S.VectorSpace</span> a, <span class="dt">S.Scalar</span> a <span class="fu">~</span> a)
               <span class="ot">=&gt;</span> <span class="dt">Simplex</span> (<span class="dt">Vector</span> a)
               <span class="ot">-&gt;</span> <span class="dt">DifferentialForm</span> a
               <span class="ot">-&gt;</span> [<span class="dt">Vector</span> a]
               <span class="ot">-&gt;</span> [[<span class="dt">Vector</span> a]]
               <span class="ot">-&gt;</span> [a]
evalSeparately t omega vs fs <span class="fu">=</span> V.toList <span class="fu">$</span> foldl S.addV zero crossres
  <span class="kw">where</span> bvals <span class="fu">=</span> B.tabulateBernstein t vs (fst omegasplit)
        fvals <span class="fu">=</span> [[F.apply ds f eta <span class="fu">|</span> f <span class="ot">&lt;-</span> fs] <span class="fu">|</span> eta <span class="ot">&lt;-</span> (snd omegasplit)]
        crossres <span class="fu">=</span> map V.vector <span class="fu">$</span> zipWith (liftA2 S.mul) fvals bvals
        ds <span class="fu">=</span> P.barycentricGradients t
        omegasplit <span class="fu">=</span> F.split omega
        l    <span class="fu">=</span> (length vs) <span class="fu">*</span> (length fs)
        zero <span class="fu">=</span> V.vector (replicate l <span class="fu">$</span> S.fromDouble <span class="fl">0.0</span>)

<span class="ot">inner ::</span> <span class="dt">S.Field</span> a <span class="ot">=&gt;</span> <span class="dt">DifferentialForm</span> a <span class="ot">-&gt;</span> <span class="dt">DifferentialForm</span> a <span class="ot">-&gt;</span> a
inner omega eta
    <span class="fu">|</span> not (null t) <span class="fu">=</span> F.inner (B.proj (head t)) omega eta
    <span class="fu">|</span> otherwise <span class="fu">=</span>
        error <span class="st">&quot;Inner: Need associated simplex to compute inner product.&quot;</span>
  <span class="kw">where</span> t <span class="fu">=</span> mapMaybe findSimplex [omega, eta]

<span class="ot">integrate ::</span> <span class="dt">S.Field</span> a <span class="ot">=&gt;</span> <span class="dt">Simplex</span> (<span class="dt">Vector</span> a) <span class="ot">-&gt;</span> <span class="dt">DifferentialForm</span> a <span class="ot">-&gt;</span> a
integrate t omega <span class="fu">=</span> B.integratePolynomial t b'
  <span class="kw">where</span> b' <span class="fu">=</span> S.sclV (S.mulInv (S.mul kfac (volume t))) b
        b  <span class="fu">=</span> apply omega (spanningVectors t)
        kfac  <span class="fu">=</span> S.fromInt (C.factorial (topologicalDimension t))</code></pre></div>
<div id="refs" class="references">

</div>

        </div>
        <div id="footer">
            Site proudly generated by
            <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>
      </div>
      </div>

    </body>
</html>
